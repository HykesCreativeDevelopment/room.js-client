#!/usr/bin/env bash

# generate coverage for compiled output
node --use_strict --harmony ./node_modules/.bin/istanbul cover ./node_modules/.bin/tape -- 'test/**/*.js' > /dev/null

# remap coverage using sourcemaps
cat ./coverage/coverage.json | ./node_modules/.bin/remap-istanbul -o ./coverage/lcov-remapped.info -t lcovonly --exclude node_modules,knockout.js

# replace original with remapped
rm ./coverage/lcov.info
mv ./coverage/lcov-remapped.info ./coverage/lcov.info

# remove json coverage so codecov uses lcov.info only
rm ./coverage/coverage.json
