<!doctype html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv='x-ua-compatible' content='ie=edge'>
    <title>Room.js Client</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <link rel='stylesheet' href='http://fonts.googleapis.com/css?family=Source+Code+Pro:400'>
    <link rel='stylesheet' href='css/main.css'>

    <script>
      var SERVER_URI = 'http://localhost:8888' // TODO: how to make this configurable?
    </script>
  </head>
  <body data-bind='event: {keydown: onKeyDown}'>
    <!--[if lt IE 10]>
        <p class='browserupgrade'>You are using an <strong>outdated</strong> browser. Please <a href='http://browsehappy.com/'>upgrade your browser</a> to improve your experience.</p>
    <![endif]-->

    <!-- No Tabs Template -->
    <script id='no-tabs' type='text/html'>
      <div class='client'>
        <div class='screen'>
          <div>You have no tabs open. Open a new <a href='#' data-bind='click: newClientTab'>client tab</a>to get started.</div>
        </div>
      </div>
    </script>

    <!-- Client Template -->
    <script id='client' type='text/html'>
      <div class='client'>
        <div class='screen' data-bind='foreach: lines'>
          <div data-bind='html: $data'></div>
        </div>
        <div class='command'>
          <form data-bind='submit: sendCommand'>
            <span class='prompt' data-bind='html: promptFormatted'></span><input autofocus=true data-bind="value: command, hasFocus: inputHasFocus, attr: {type: inputType}, event: {keydown: onRecall}"></input>
          </form>
        </div>
      </div>
    </script>

    <!-- Function Editor Template -->
    <script id='function-editor' type='text/html'></script>

    <ul class='tabs' data-bind='foreach: tabs, visible: visible'>
      <li class='tab' data-bind='attr: {title: name}, css: {active: active, dirty: dirty}, click: select'>
        <div class='tab-name' data-bind='text: name'></div>
        <div class='tab-close-button' data-bind='click: close, clickBubble: false'></div>
      </li>
    </ul>
    <div class='tab-pane' data-bind='template: templateBinding, css: tabPaneClasses'>
    </div>
    <div data-bind='if: editorHasLoaded'>
      <div class='editor' data-bind='visible: editorVisible, autoHeight: autoHeight, ace: activeAceBinding'></div>
    </div>

    <!-- exports bundle -->
    <script src='js/bundle.js'></script>

    <script>
      (function() {
        var TabsViewModel = bundle.TabsViewModel;
        var ko = bundle.ko;

        // exports io
        document.write('<script src="' + SERVER_URI + '/socket.io/socket.io.js"><\/script>')

        document.addEventListener('DOMContentLoaded', function() {
          if (typeof io === 'undefined') {
            alert('Unable to connect to ' + SERVER_URI);
          } else {
            // var socket = io.connect(SERVER_URI);
            // ko.applyBindings(new ClientView(socket));
            ko.applyBindings(new TabsViewModel());
          }
        });
      })();
    </script>
  </body>
</html>
