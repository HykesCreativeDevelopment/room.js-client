{"version":3,"file":"bundle.js","sources":["../../src/lib/ko-codemirror.js","../../src/lib/ko-uncloak.js","../../src/lib/colors.js","../../src/view-models/search-view-model.js","../../src/lib/add-sane-on-unload-handler.js","../../node_modules/ansi_up/ansi_up.js","../../src/view-models/client-view-model.js","../../src/view-models/client-tab-view-model.js","../../src/view-models/verb-editor-view-model.js","../../src/view-models/verb-editor-tab-view-model.js","../../src/view-models/function-editor-view-model.js","../../src/view-models/function-editor-tab-view-model.js","../../src/view-models/tabs-view-model.js"],"sourcesContent":["function register (ko, CodeMirror) {\n  function init (element, valueAccessor, allBindings) {\n    const options = allBindings.get('codemirrorOptions') || {}\n    options.value = ko.unwrap(valueAccessor())\n    const editor = CodeMirror(element, options) // eslint-disable-line new-cap\n\n    editor.on('change', cm => {\n      const value = valueAccessor()\n      value(cm.getValue())\n    })\n\n    element.editor = editor\n  }\n\n  function update (element, valueAccessor) {\n    const observedValue = ko.unwrap(valueAccessor())\n\n    if (element.editor) {\n      const changed = observedValue !== element.editor.getValue()\n\n      if (changed) {\n        element.editor.setValue(observedValue)\n        element.editor.refresh()\n      }\n    }\n  }\n\n  ko.bindingHandlers.codemirror = { init, update }\n}\n\nexport default { register }\n","function register (ko) {\n  function init (element) {\n    element.classList.remove('cloak')\n  }\n\n  ko.bindingHandlers.uncloak = { init }\n}\n\nexport default { register }\n","export function boldRed (str) {\n  return `\\u001b[1m\\u001b[31m${str}\\u001b[39m\\u001b[22m`\n}\n\nexport function boldGreen (str) {\n  return `\\u001b[1m\\u001b[32m${str}\\u001b[39m\\u001b[22m`\n}\n\nexport function gray (str) {\n  return `\\u001b[90m${str}\\u001b[39m`\n}\n","function isElementVisibleIn (el, container) {\n  const elRect = el.getBoundingClientRect()\n  const containerRect = container.getBoundingClientRect()\n\n  return (\n    elRect.top >= containerRect.top &&\n    elRect.left >= containerRect.left &&\n    elRect.bottom <= containerRect.bottom &&\n    elRect.right <= containerRect.right\n  )\n}\n\nclass SearchResult {\n  constructor (ko, data) {\n    this.data = data\n    this.objectId = data.objectId\n    this.active = ko.observable(false)\n    this.name = ko.computed(this.computeName.bind(this))\n  }\n\n  static newFromResult (ko, result) {\n    if (result.function) {\n      // eslint-disable-next-line no-use-before-define\n      return new FunctionSearchResult(ko, result)\n    } else if (result.verb) {\n      // eslint-disable-next-line no-use-before-define\n      return new VerbSearchResult(ko, result)\n    }\n    throw new Error('Invalid result type.')\n  }\n\n  computeName () {\n    throw new Error('Must be subclassed.')\n  }\n\n  openEditor () {\n    throw new Error('Must be subclassed.')\n  }\n}\n\nclass FunctionSearchResult extends SearchResult {\n  computeName () {\n    return `${this.objectId}.${this.data.function}`\n  }\n\n  openEditor (socket, tabsViewModel) {\n    const params = { objectId: this.objectId, name: this.data.function }\n    socket.emit('get-function', params, data => {\n      tabsViewModel.newEditFunctionTab(socket, data)\n    })\n  }\n}\n\nclass VerbSearchResult extends SearchResult {\n  computeName () {\n    return `${this.objectId}.${this.data.verb}`\n  }\n\n  openEditor (socket, tabsViewModel) {\n    const params = { objectId: this.objectId, name: this.data.verb }\n    socket.emit('get-verb', params, data => {\n      tabsViewModel.newEditVerbTab(socket, data)\n    })\n  }\n}\n\n// TODO: socket permissions\nexport default class SearchViewModel {\n  constructor ({ doc, ko }, parentViewModel, socket) {\n    this.document = doc\n    this.ko = ko\n    this.parentViewModel = parentViewModel\n    this.socket = socket\n    this.inputHasFocus = true\n\n    this.search = ko.observable('')\n    this.results = ko.observableArray([])\n    this.selectedIndex = ko.observable(0)\n    this.selectionDirection = ko.observable(0)\n\n    this.search.subscribe(this.onSearch.bind(this))\n\n    this.activeResult = ko.computed(this.computeActiveResult.bind(this))\n    this.hasResults = ko.computed(() => this.results().length > 0)\n  }\n\n  computeActiveResult () {\n    const results = this.results()\n    const selectedIndex = this.selectedIndex()\n\n    if (results.length > 0) {\n      results.forEach(result => { result.active(false) })\n      results[selectedIndex].active(true)\n      this.scrollActiveResultIntoView()\n      return results[selectedIndex]\n    }\n    return null\n  }\n\n  scrollActiveResultIntoView () {\n    const el = this.document.querySelector('.search .results li.active')\n    const container = this.document.querySelector('.search .results')\n    if (el && !isElementVisibleIn(el, container)) {\n      el.scrollIntoView(this.selectionDirection() === -1)\n    }\n  }\n\n  close () {\n    this.parentViewModel.searchViewModel(null)\n  }\n\n  openActiveResult () {\n    const activeResult = this.activeResult()\n    activeResult.openEditor(this.socket, this.parentViewModel)\n  }\n\n  onSearch (str) {\n    this.socket.emit('search', str, results => {\n      this.selectedIndex(0)\n      this.results(results.map(result => SearchResult.newFromResult(this.ko, result)))\n    })\n  }\n\n  onKeyDown (_, event) {\n    const key = typeof event.which === 'undefined' ? event.keyCode : event.which\n    const selectedIndex = this.selectedIndex()\n\n    switch (key) {\n      case 13: { // enter key\n        this.openActiveResult()\n        this.close()\n        return false\n      }\n      case 27: { // esc key\n        this.close()\n        return false\n      }\n      case 38: { // up key\n        if (selectedIndex > 0) {\n          this.selectedIndex(selectedIndex - 1)\n        } else {\n          this.selectedIndex(this.results().length - 1)\n        }\n        this.selectionDirection(-1)\n        return false\n      }\n      case 40: { // down key\n        if (selectedIndex < this.results().length - 1) {\n          this.selectedIndex(selectedIndex + 1)\n        } else {\n          this.selectedIndex(0)\n        }\n        this.selectionDirection(1)\n        return false\n      }\n      default: {\n        return true\n      }\n    }\n  }\n}\n","// Credit: http://stackoverflow.com/users/39013/josiah-ruddell\n// http://stackoverflow.com/questions/4126820/window-onbeforeunload-may-fire-multiple-times\n\nconst NAVIGATE_AWAY_MESSAGE = 'This action will log you out of the game!'\n\nexport default function addSaneOnUnloadHandler (win, promptBeforeLeaving = () => true) {\n  let alreadPrompted = false\n  let timeoutID = 0\n\n  const reset = () => {\n    alreadPrompted = false\n    timeoutID = 0\n  }\n\n  win.onbeforeunload = () => {\n    if (promptBeforeLeaving() && !alreadPrompted) {\n      alreadPrompted = true\n      timeoutID = setTimeout(reset, 100)\n      return NAVIGATE_AWAY_MESSAGE\n    }\n    return null\n  }\n\n  win.onunload = () => {\n    clearTimeout(timeoutID)\n  }\n}\n","/*  ansi_up.js\n *  author : Dru Nelson\n *  license : MIT\n *  http://github.com/drudru/ansi_up\n */\n(function (factory) {\n    var v;\n    if (typeof module === \"object\" && typeof module.exports === \"object\") {\n        v = factory(require, exports);\n        if (\"undefined\" !== typeof v) module.exports = v;\n    }\n    else if (\"function\" === typeof define && define.amd) {\n        define([\"require\", \"exports\"], factory);\n    }\n    else {\n        var req, exp = {};\n        v = factory(req, exp);\n        window.AnsiUp = exp.default;\n    }\n})(function (require, exports) {\n\n\"use strict\";\nfunction rgx(tmplObj) {\n    var subst = [];\n    for (var _i = 1; _i < arguments.length; _i++) {\n        subst[_i - 1] = arguments[_i];\n    }\n    var regexText = tmplObj.raw[0];\n    var wsrgx = /^\\s+|\\s+\\n|\\s+#[\\s\\S]+?\\n/gm;\n    var txt2 = regexText.replace(wsrgx, '');\n    return new RegExp(txt2, 'm');\n}\nvar AnsiUp = (function () {\n    function AnsiUp() {\n        this.VERSION = \"2.0.1\";\n        this.ansi_colors = [\n            [\n                { rgb: [0, 0, 0], class_name: \"ansi-black\" },\n                { rgb: [187, 0, 0], class_name: \"ansi-red\" },\n                { rgb: [0, 187, 0], class_name: \"ansi-green\" },\n                { rgb: [187, 187, 0], class_name: \"ansi-yellow\" },\n                { rgb: [0, 0, 187], class_name: \"ansi-blue\" },\n                { rgb: [187, 0, 187], class_name: \"ansi-magenta\" },\n                { rgb: [0, 187, 187], class_name: \"ansi-cyan\" },\n                { rgb: [255, 255, 255], class_name: \"ansi-white\" }\n            ],\n            [\n                { rgb: [85, 85, 85], class_name: \"ansi-bright-black\" },\n                { rgb: [255, 85, 85], class_name: \"ansi-bright-red\" },\n                { rgb: [0, 255, 0], class_name: \"ansi-bright-green\" },\n                { rgb: [255, 255, 85], class_name: \"ansi-bright-yellow\" },\n                { rgb: [85, 85, 255], class_name: \"ansi-bright-blue\" },\n                { rgb: [255, 85, 255], class_name: \"ansi-bright-magenta\" },\n                { rgb: [85, 255, 255], class_name: \"ansi-bright-cyan\" },\n                { rgb: [255, 255, 255], class_name: \"ansi-bright-white\" }\n            ]\n        ];\n        this.htmlFormatter = {\n            transform: function (fragment, instance) {\n                var txt = fragment.text;\n                if (txt.length === 0)\n                    return txt;\n                if (instance._escape_for_html)\n                    txt = instance.old_escape_for_html(txt);\n                if (!fragment.bright && fragment.fg === null && fragment.bg === null)\n                    return txt;\n                var styles = [];\n                var classes = [];\n                var fg = fragment.fg;\n                var bg = fragment.bg;\n                if (fg === null && fragment.bright)\n                    fg = instance.ansi_colors[1][7];\n                if (!instance._use_classes) {\n                    if (fg)\n                        styles.push(\"color:rgb(\" + fg.rgb.join(',') + \")\");\n                    if (bg)\n                        styles.push(\"background-color:rgb(\" + bg.rgb + \")\");\n                }\n                else {\n                    if (fg) {\n                        if (fg.class_name !== 'truecolor') {\n                            classes.push(fg.class_name + \"-fg\");\n                        }\n                        else {\n                            styles.push(\"color:rgb(\" + fg.rgb.join(',') + \")\");\n                        }\n                    }\n                    if (bg) {\n                        if (bg.class_name !== 'truecolor') {\n                            classes.push(bg.class_name + \"-bg\");\n                        }\n                        else {\n                            styles.push(\"background-color:rgb(\" + bg.rgb.join(',') + \")\");\n                        }\n                    }\n                }\n                var class_string = '';\n                var style_string = '';\n                if (classes.length)\n                    class_string = \" class=\\\"\" + classes.join(' ') + \"\\\"\";\n                if (styles.length)\n                    style_string = \" style=\\\"\" + styles.join(';') + \"\\\"\";\n                return \"<span\" + class_string + style_string + \">\" + txt + \"</span>\";\n            },\n            compose: function (segments, instance) {\n                return segments.join(\"\");\n            }\n        };\n        this.textFormatter = {\n            transform: function (fragment, instance) {\n                return fragment.text;\n            },\n            compose: function (segments, instance) {\n                return segments.join(\"\");\n            }\n        };\n        this.setup_256_palette();\n        this._use_classes = false;\n        this._escape_for_html = true;\n        this.bright = false;\n        this.fg = this.bg = null;\n        this._buffer = '';\n    }\n    Object.defineProperty(AnsiUp.prototype, \"use_classes\", {\n        get: function () {\n            return this._use_classes;\n        },\n        set: function (arg) {\n            this._use_classes = arg;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(AnsiUp.prototype, \"escape_for_html\", {\n        get: function () {\n            return this._escape_for_html;\n        },\n        set: function (arg) {\n            this._escape_for_html = arg;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    AnsiUp.prototype.setup_256_palette = function () {\n        var _this = this;\n        this.palette_256 = [];\n        this.ansi_colors.forEach(function (palette) {\n            palette.forEach(function (rec) {\n                _this.palette_256.push(rec);\n            });\n        });\n        var levels = [0, 95, 135, 175, 215, 255];\n        for (var r = 0; r < 6; ++r) {\n            for (var g = 0; g < 6; ++g) {\n                for (var b = 0; b < 6; ++b) {\n                    var col = { rgb: [levels[r], levels[g], levels[b]], class_name: 'truecolor' };\n                    this.palette_256.push(col);\n                }\n            }\n        }\n        var grey_level = 8;\n        for (var i = 0; i < 24; ++i, grey_level += 10) {\n            var gry = { rgb: [grey_level, grey_level, grey_level], class_name: 'truecolor' };\n            this.palette_256.push(gry);\n        }\n    };\n    AnsiUp.prototype.old_escape_for_html = function (txt) {\n        return txt.replace(/[&<>]/gm, function (str) {\n            if (str === \"&\")\n                return \"&amp;\";\n            if (str === \"<\")\n                return \"&lt;\";\n            if (str === \">\")\n                return \"&gt;\";\n        });\n    };\n    AnsiUp.prototype.old_linkify = function (txt) {\n        return txt.replace(/(https?:\\/\\/[^\\s]+)/gm, function (str) {\n            return \"<a href=\\\"\" + str + \"\\\">\" + str + \"</a>\";\n        });\n    };\n    AnsiUp.prototype.detect_incomplete_ansi = function (txt) {\n        return !(/.*?[\\x40-\\x7e]/.test(txt));\n    };\n    AnsiUp.prototype.detect_incomplete_link = function (txt) {\n        var found = false;\n        for (var i = txt.length - 1; i > 0; i--) {\n            if (/\\s|\\x1B/.test(txt[i])) {\n                found = true;\n                break;\n            }\n        }\n        if (!found) {\n            if (/(https?:\\/\\/[^\\s]+)/.test(txt))\n                return 0;\n            else\n                return -1;\n        }\n        var prefix = txt.substr(i + 1, 4);\n        if (prefix.length === 0)\n            return -1;\n        if (\"http\".indexOf(prefix) === 0)\n            return (i + 1);\n    };\n    AnsiUp.prototype.ansi_to = function (txt, formatter) {\n        var pkt = this._buffer + txt;\n        this._buffer = '';\n        var raw_text_pkts = pkt.split(/\\x1B\\[/);\n        if (raw_text_pkts.length === 1)\n            raw_text_pkts.push('');\n        this.handle_incomplete_sequences(raw_text_pkts);\n        var first_chunk = this.with_state(raw_text_pkts.shift());\n        var blocks = new Array(raw_text_pkts.length);\n        for (var i = 0, len = raw_text_pkts.length; i < len; ++i) {\n            blocks[i] = (formatter.transform(this.process_ansi(raw_text_pkts[i]), this));\n        }\n        if (first_chunk.text.length > 0)\n            blocks.unshift(formatter.transform(first_chunk, this));\n        return formatter.compose(blocks, this);\n    };\n    AnsiUp.prototype.ansi_to_html = function (txt) {\n        return this.ansi_to(txt, this.htmlFormatter);\n    };\n    AnsiUp.prototype.ansi_to_text = function (txt) {\n        return this.ansi_to(txt, this.textFormatter);\n    };\n    AnsiUp.prototype.with_state = function (text) {\n        return { bright: this.bright, fg: this.fg, bg: this.bg, text: text };\n    };\n    AnsiUp.prototype.handle_incomplete_sequences = function (chunks) {\n        var last_chunk = chunks[chunks.length - 1];\n        if ((last_chunk.length > 0) && this.detect_incomplete_ansi(last_chunk)) {\n            this._buffer = \"\\x1B[\" + last_chunk;\n            chunks.pop();\n            chunks.push('');\n        }\n        else {\n            if (last_chunk.slice(-1) === \"\\x1B\") {\n                this._buffer = \"\\x1B\";\n                console.log(\"raw\", chunks);\n                chunks.pop();\n                chunks.push(last_chunk.substr(0, last_chunk.length - 1));\n                console.log(chunks);\n                console.log(last_chunk);\n            }\n            if (chunks.length === 2 &&\n                chunks[1] === \"\" &&\n                chunks[0].slice(-1) === \"\\x1B\") {\n                this._buffer = \"\\x1B\";\n                last_chunk = chunks.shift();\n                chunks.unshift(last_chunk.substr(0, last_chunk.length - 1));\n            }\n        }\n    };\n    AnsiUp.prototype.process_ansi = function (block) {\n        if (!this._sgr_regex) {\n            this._sgr_regex = (_a = [\"\\n            ^                           # beginning of line\\n            ([!<-?]?)             # a private-mode char (!, <, =, >, ?)\\n            ([d;]*)                    # any digits or semicolons\\n            ([ -/]?               # an intermediate modifier\\n            [@-~])                # the command\\n            ([sS]*)                   # any text following this CSI sequence\\n          \"], _a.raw = [\"\\n            ^                           # beginning of line\\n            ([!\\\\x3c-\\\\x3f]?)             # a private-mode char (!, <, =, >, ?)\\n            ([\\\\d;]*)                    # any digits or semicolons\\n            ([\\\\x20-\\\\x2f]?               # an intermediate modifier\\n            [\\\\x40-\\\\x7e])                # the command\\n            ([\\\\s\\\\S]*)                   # any text following this CSI sequence\\n          \"], rgx(_a));\n        }\n        var matches = block.match(this._sgr_regex);\n        if (!matches) {\n            return this.with_state(block);\n        }\n        var orig_txt = matches[4];\n        if (matches[1] !== '' || matches[3] !== 'm') {\n            return this.with_state(orig_txt);\n        }\n        var sgr_cmds = matches[2].split(';');\n        while (sgr_cmds.length > 0) {\n            var sgr_cmd_str = sgr_cmds.shift();\n            var num = parseInt(sgr_cmd_str, 10);\n            if (isNaN(num) || num === 0) {\n                this.fg = this.bg = null;\n                this.bright = false;\n            }\n            else if (num === 1) {\n                this.bright = true;\n            }\n            else if (num === 22) {\n                this.bright = false;\n            }\n            else if (num === 39) {\n                this.fg = null;\n            }\n            else if (num === 49) {\n                this.bg = null;\n            }\n            else if ((num >= 30) && (num < 38)) {\n                var bidx = this.bright ? 1 : 0;\n                this.fg = this.ansi_colors[bidx][(num - 30)];\n            }\n            else if ((num >= 90) && (num < 98)) {\n                this.fg = this.ansi_colors[1][(num - 90)];\n            }\n            else if ((num >= 40) && (num < 48)) {\n                this.bg = this.ansi_colors[0][(num - 40)];\n            }\n            else if ((num >= 100) && (num < 108)) {\n                this.bg = this.ansi_colors[1][(num - 100)];\n            }\n            else if (num === 38 || num === 48) {\n                if (sgr_cmds.length > 0) {\n                    var is_foreground = (num === 38);\n                    var mode_cmd = sgr_cmds.shift();\n                    if (mode_cmd === '5' && sgr_cmds.length > 0) {\n                        var palette_index = parseInt(sgr_cmds.shift(), 10);\n                        if (palette_index >= 0 && palette_index <= 255) {\n                            if (is_foreground)\n                                this.fg = this.palette_256[palette_index];\n                            else\n                                this.bg = this.palette_256[palette_index];\n                        }\n                    }\n                    if (mode_cmd === '2' && sgr_cmds.length > 2) {\n                        var r = parseInt(sgr_cmds.shift(), 10);\n                        var g = parseInt(sgr_cmds.shift(), 10);\n                        var b = parseInt(sgr_cmds.shift(), 10);\n                        if ((r >= 0 && r <= 255) && (g >= 0 && g <= 255) && (b >= 0 && b <= 255)) {\n                            var c = { rgb: [r, g, b], class_name: 'truecolor' };\n                            if (is_foreground)\n                                this.fg = c;\n                            else\n                                this.bg = c;\n                        }\n                    }\n                }\n            }\n        }\n        return this.with_state(orig_txt);\n        var _a;\n    };\n    return AnsiUp;\n}());\n//# sourceMappingURL=ansi_up.js.map\n    Object.defineProperty(exports, \"__esModule\", { value: true });\n    exports.default = AnsiUp;\n});","import AnsiUp from 'ansi_up'\nimport { boldRed, boldGreen, gray } from '../lib/colors'\n\nexport default class ClientViewModel {\n  constructor (deps, parentViewModel) {\n    const { SERVER_URI, doc, win, ko, io, linkifyHtml } = deps\n    const { observable, observableArray, computed } = ko\n\n    this.window = win\n    this.linkifyHtml = linkifyHtml\n    this.ansiUp = new AnsiUp()\n    this.ansiUp.use_classes = true\n\n    // Elements\n\n    // Scrolling element is body on Webkit-based browsers,\n    // html on Firefox and Internet Explorer. All recent\n    // browsers tend to support document.scrollingElement from\n    // CSSOM working draft.\n    this.$scrollingElement = doc.scrollingElement\n    if (typeof this.$scrollingElement === 'undefined') {\n      this.$scrollingElement = doc.querySelector('html')\n    }\n\n    // Properties\n\n    this.parentViewModel = parentViewModel\n    this.socket = io.connect(SERVER_URI)\n    this.history = []\n    this.inputCallback = null\n\n    // Observables\n\n    this.lines = observableArray([])\n    this.command = observable('')\n    this.inputType = observable('text')\n    this.promptStr = observable('')\n    this.rightPromptStr = observable('')\n    this.inputHasFocus = observable(true)\n    this.loggedIn = observable(false)\n    this.playing = observable(false)\n\n    // client config\n    this.maxLines = observable(this.readConfig('maxLines') || 1000)\n    this.maxHistory = observable(this.readConfig('maxHistory') || 1000)\n    this.echo = observable(this.readConfig('echo') || false)\n    this.space = observable(this.readConfig('space') || false)\n\n    // Computeds\n\n    this.promptFormatted = computed(() => this.colorize(this.composedPrompt()))\n    this.rightPromptFormatted = computed(() => this.colorize(this.rightPromptStr()))\n\n    // Subscribers\n\n    this.maxLines.subscribe(max => {\n      if (this.lines().length > max) { this.truncateLines() }\n    })\n\n    this.maxHistory.subscribe(max => {\n      if (this.history().length > max) { this.truncateHistory() }\n    })\n\n    this.echo.subscribe(echo => { this.writeConfig('echo', echo) })\n    this.space.subscribe(space => { this.writeConfig('space', space) })\n\n    // Socket Setup\n\n    this.socket.on('connect', this.onConnect.bind(this))\n    this.socket.on('connecting', this.onConnecting.bind(this))\n    this.socket.on('disconnect', this.onDisconnect.bind(this))\n    this.socket.on('connect_failed', this.onConnectFailed.bind(this))\n    this.socket.on('error', this.onError.bind(this))\n    this.socket.on('reconnect_failed', this.onReconnectFailed.bind(this))\n    this.socket.on('reconnect', this.onReconnect.bind(this))\n    this.socket.on('reconnecting', this.onReconnecting.bind(this))\n    this.socket.on('output', this.onOutput.bind(this))\n    this.socket.on('set-prompt', this.onSetPrompt.bind(this))\n    this.socket.on('set-right-prompt', this.onSetRightPrompt.bind(this))\n    this.socket.on('request-input', this.onRequestInput.bind(this))\n    this.socket.on('edit-verb', this.onEditVerb.bind(this))\n    this.socket.on('edit-function', this.onEditFunction.bind(this))\n    this.socket.on('login', this.onLogin.bind(this))\n    this.socket.on('logout', this.onLogout.bind(this))\n    this.socket.on('playing', this.onPlaying.bind(this))\n    this.socket.on('quit', this.onQuit.bind(this))\n\n    this.addLine(gray('Connecting...'))\n  }\n\n  composedPrompt (optionalStr = '') {\n    return `${this.promptStr()} > ${optionalStr}`.trim()\n  }\n\n  setPrompt (str, type) {\n    this.promptStr(str)\n    if (type) { this.inputType(type) }\n  }\n\n  setRightPrompt (str) {\n    this.rightPromptStr(str)\n  }\n\n  sendCommand () {\n    const command = this.command().trim()\n\n    if (!command) { return }\n\n    this.echoCommand(command)\n    this.addToHistory(command)\n\n    if (this.handleClientCommand(command)) {\n      // done, client handled command\n    } else if (!this.socket.connected) {\n      this.addLine(boldRed('Not connected.'))\n    } else if (this.inputCallback) {\n      this.handleInputCallback(command)\n    } else {\n      this.socket.emit('input', command)\n    }\n\n    this.command('')\n  }\n\n  echoCommand (command) {\n    if (!this.echo() || this.inputType() === 'password') { return }\n    this.addLine(this.composedPrompt(command))\n    if (this.space()) { this.addLine(' ') }\n  }\n\n  addToHistory (command) {\n    if (this.inputType() === 'password') { return }\n    this.history.unshift(command)\n    if (this.history.length > this.maxHistory()) { this.truncateHistory() }\n    this.currentHistory = -1\n  }\n\n  handleClientCommand (command) {\n    switch (command) {\n      case '.clear': this.lines([]); return true\n      case '.connect': this.reconnectSocket(); return true\n      case '.disconnect': this.disconnectSocket(); return true\n      case '.echo on': this.echo(true); return true\n      case '.echo off': this.echo(false); return true\n      case '.space on': this.space(true); return true\n      case '.space off': this.space(false); return true\n      case '.new tab': this.parentViewModel.parentViewModel.newClientTab(); return true\n      case '.close tab': this.parentViewModel.close(); return true\n      default: return false\n    }\n  }\n\n  handleInputCallback (command) {\n    const callback = this.inputCallback\n    this.inputCallback = null\n    callback(command)\n  }\n\n  addLine (line) {\n    this.lines.push(this.colorize(line))\n    this.scrollToBottom()\n  }\n\n  disconnectSocket () {\n    if (this.socket.connected) {\n      this.socket.disconnect()\n    } else {\n      this.addLine(boldRed('Not connected.'))\n    }\n  }\n\n  reconnectSocket () {\n    if (this.socket.connected) {\n      this.addLine(boldRed('Already connected.'))\n    } else {\n      this.socket.connect()\n    }\n  }\n\n  scrollToBottom () {\n    this.$scrollingElement.scrollTop =\n      this.$scrollingElement.scrollHeight - this.window.innerHeight\n  }\n\n  truncateHistory () {\n    this.history = this.history.slice(0, this.maxHistory())\n  }\n\n  truncateLines () {\n    const lengthDiff = this.lines().length - this.maxLines()\n    this.lines(this.lines.slice(lengthDiff))\n  }\n\n  willClose () {\n    this.socket.disconnect()\n    return true\n  }\n\n  // Event handlers\n\n  onKeyDown (_, event) {\n    const key = typeof event.which === 'undefined' ? event.keyCode : event.which\n    const meta = event.metaKey\n    const ctrl = event.ctrlKey\n    const shift = event.shiftKey\n    const vKey = key === 86\n    const upKey = key === 38\n    const downKey = key === 40\n    const tabKey = key === 9\n\n    // if holding control or command and not trying to paste,\n    // ignore this keypress\n    if ((meta && !vKey) || (ctrl && !vKey)) {\n      return true\n    }\n\n    // otherwise, re-focus the input before the key is let up\n    if (!this.inputHasFocus()) {\n      this.inputHasFocus(true)\n      // when hitting up or down and not focused,\n      // the keydown event doesn't get passed on\n      if (upKey || downKey) {\n        // HACK fake event object\n        return this.onRecall(null, { which: key })\n      }\n    }\n\n    if (tabKey) {\n      const direction = shift ? -1 : 1\n      this.socket.emit('tab-key-press', { direction })\n      return false\n    }\n\n    return true\n  }\n\n  onClick (_, event) {\n    if (event.target && event.target.hash) {\n      const pattern = /#cmd\\[(.*?)]/g\n      const match = pattern.exec(event.target.hash)\n      if (!match) { return true }\n      const command = decodeURIComponent(match[1]) // URI-encoded on some browsers (e.g. Firefox)\n      this.command(command)\n      this.sendCommand()\n      return false\n    }\n    return true\n  }\n\n  onRecall (_, event) {\n    const key = typeof event.which === 'undefined' ? event.keyCode : event.which\n    if (this.history.length === 0) { return true }\n    switch (key) {\n      case 38: { // up key\n        if (this.currentHistory < this.history.length - 1) {\n          this.currentHistory += 1\n        }\n        this.command(this.history[this.currentHistory])\n        return false\n      }\n      case 40: { // down key\n        if (this.currentHistory > -1) {\n          this.currentHistory -= 1\n        }\n        if (this.currentHistory >= 0) {\n          this.command(this.history[this.currentHistory])\n        } else {\n          this.command('')\n        }\n        break\n      }\n      default: {\n        break\n      }\n    }\n    return true\n  }\n\n  // Socket event handlers\n\n  onConnect () { this.addLine(boldGreen('Connected!')) }\n  onConnecting () { this.addLine(gray('Connecting...')) }\n\n  onDisconnect () {\n    this.addLine(boldRed('Disconnected from server.'))\n    this.setPrompt('')\n    this.inputCallback = null\n    this.loggedIn(false)\n    this.playing(false)\n  }\n\n  onConnectFailed () { this.addLine(boldRed('Connection to server failed.')) }\n  onError () { this.addLine(boldRed('An unknown error occurred.')) }\n  onReconnectFailed () { this.addLine(boldRed('Unable to reconnect to server.')) }\n  onReconnect () {}\n  onReconnecting () {}\n\n  onOutput (msg) {\n    if (msg && msg.toString) {\n      this.addLine(msg.toString())\n      if (this.space()) { this.addLine(' ') }\n    }\n  }\n\n  onSetPrompt (str) {\n    this.setPrompt(str)\n  }\n\n  onSetRightPrompt (str) {\n    this.setRightPrompt(str)\n  }\n\n  onEditVerb (data) {\n    this.parentViewModel.parentViewModel.newEditVerbTab(this.socket, data)\n  }\n\n  onEditFunction (data) {\n    this.parentViewModel.parentViewModel.newEditFunctionTab(this.socket, data)\n  }\n\n  onLogin () {\n    this.loggedIn(true)\n  }\n\n  onLogout () {\n    this.loggedIn(false)\n  }\n\n  onPlaying () {\n    this.playing(true)\n  }\n\n  onQuit () {\n    this.playing(false)\n  }\n\n  onRequestInput (inputs, fn) {\n    const promptWas = this.promptStr()\n    this.getInputFromUser({}, inputs, formData => {\n      this.setPrompt(promptWas, 'text')\n      fn(formData)\n    })\n  }\n\n  // Helpers for the above\n\n  getInputFromUser (data, inputs, done) {\n    if (inputs.length === 0) { done(data); return }\n\n    const [input, ...restInputs] = inputs\n\n    this.setPrompt(input.label || 'input', input.type || 'text')\n\n    this.inputCallback = userInput => {\n      data[input.name || 'input'] = userInput\n      this.getInputFromUser(data, restInputs, done)\n    }\n  }\n\n  // Local storage helpers\n\n  readConfig (key) {\n    return this.window.localStorage ? JSON.parse(this.window.localStorage.getItem(key)) : null\n  }\n\n  writeConfig (key, value) {\n    if (this.window.localStorage) {\n      this.window.localStorage.setItem(key, JSON.stringify(value))\n    }\n  }\n\n  // Color and HTML helpers\n\n  linkifyCommands (str) {\n    const pattern = /#cmd\\[(.*?)]/g\n    return str.replace(pattern, (match, capture) => `<a href='${match}'>${capture}</a>`)\n  }\n\n  colorize (str) {\n    return this.linkifyCommands(this.linkifyHtml(this.ansiUp.ansi_to_html(str)))\n  }\n}\n","import ClientViewModel from './client-view-model'\n\nexport default class ClientTabViewModel {\n  constructor (deps, parentViewModel) {\n    const { ko } = deps\n\n    // Properties\n\n    this.parentViewModel = parentViewModel\n    this.templateId = 'client'\n    this.viewModel = new ClientViewModel(deps, this)\n    this.dirty = false\n\n    // Observables\n\n    this.name = ko.observable('Room.js')\n\n    // Computeds\n\n    this.active = ko.computed(this.computeActive.bind(this))\n  }\n\n  templateBinding () {\n    return { name: this.templateId, data: this.viewModel }\n  }\n\n  computeActive () {\n    return this.parentViewModel.activeTab() === this\n  }\n\n  select () {\n    this.parentViewModel.activeTab(this)\n    this.viewModel.scrollToBottom()\n    this.viewModel.inputHasFocus(true)\n  }\n\n  close () {\n    if (this.viewModel.willClose()) {\n      this.parentViewModel.closeTab(this)\n    }\n  }\n\n  tabPaneClasses () {\n    return ['tab-pane-client']\n  }\n\n  hideIfOnlyMe () {\n    return true\n  }\n}\n","export default class VerbEditorViewModel {\n  constructor ({ ko, CodeMirror, win }, parentViewModel, socket, { verb, objectId }) {\n    // Properties\n\n    this.window = win\n    this.parentViewModel = parentViewModel\n    this.socket = socket\n    this.objectId = objectId\n    this.name = verb.name\n    this.codemirrorOptions = {\n      lineNumbers: true,\n      theme: 'tomorrow-night-bright',\n      tabSize: 2,\n      indentWithTabs: false,\n      extraKeys: {\n        Tab: cm => {\n          if (cm.doc.somethingSelected()) {\n            return CodeMirror.Pass\n          }\n          return cm.execCommand('insertSoftTab')\n        }\n      }\n    }\n\n    // Observables\n\n    this.pattern = ko.observable(verb.pattern)\n    this.dobjarg = ko.observable(verb.dobjarg)\n    this.preparg = ko.observable(verb.preparg)\n    this.iobjarg = ko.observable(verb.iobjarg)\n    this.code = ko.observable(verb.code)\n\n    // for dirty tracking\n    this._pattern = ko.observable(verb.pattern)\n    this._dobjarg = ko.observable(verb.dobjarg)\n    this._preparg = ko.observable(verb.preparg)\n    this._iobjarg = ko.observable(verb.iobjarg)\n    this._code = ko.observable(verb.code)\n\n    // Computeds\n\n    this.dirty = ko.computed(this.computeDirty.bind(this))\n  }\n\n  computeDirty () {\n    return this.pattern() !== this._pattern() ||\n           this.dobjarg() !== this._dobjarg() ||\n           this.preparg() !== this._preparg() ||\n           this.iobjarg() !== this._iobjarg() ||\n           this.code() !== this._code()\n  }\n\n  save () {\n    const newVerb = {\n      name: this.name,\n      pattern: this.pattern(),\n      dobjarg: this.dobjarg(),\n      preparg: this.preparg(),\n      iobjarg: this.iobjarg(),\n      code: this.code()\n    }\n    const params = {\n      objectId: this.objectId,\n      verb: newVerb\n    }\n\n    if (!this.socket.connected) {\n      // eslint-disable-next-line no-alert\n      this.window.alert([\n        'The client tab that this editor was opened from has been',\n        'closed.  You must keep that open for saving to work.'\n      ].join(' '))\n      return\n    }\n\n    this.socket.emit('save-verb', params, response => {\n      if (response === 'saved') {\n        this._pattern(this.pattern())\n        this._dobjarg(this.dobjarg())\n        this._preparg(this.preparg())\n        this._iobjarg(this.iobjarg())\n        this._code(this.code())\n      } else {\n        // eslint-disable-next-line no-alert\n        this.window.alert(response)\n      }\n    })\n  }\n\n  willClose () {\n    const msg = [\n      'Are you sure you want to close this tab?',\n      'You have unsaved changes that will be lost.'\n    ].join(' ')\n\n    return this.dirty()\n      // eslint-disable-next-line no-alert\n      ? this.window.confirm(msg)\n      : true\n  }\n\n  onKeyDown (_, event) {\n    const key = typeof event.which === 'undefined' ? event.keyCode : event.which\n    const meta = event.metaKey\n    const ctrl = event.ctrlKey\n    const sKey = key === 83\n    const wKey = key === 87\n\n    if ((ctrl && sKey) || (meta && sKey)) {\n      this.save()\n      return false\n    } else if ((ctrl && wKey) || (meta && wKey)) {\n      // this would be nice, but this is one shortcut you can't override...\n      this.parentViewModel.close()\n      return false\n    }\n    return true\n  }\n}\n","import VerbEditorViewModel from './verb-editor-view-model'\n\nexport default class VerbEditorTabViewModel {\n  constructor (deps, parentViewModel, socket, data) {\n    const { ko } = deps\n\n    // Properties\n\n    this.parentViewModel = parentViewModel\n    this.templateId = 'verb-editor'\n    this.viewModel = new VerbEditorViewModel(deps, this, socket, data)\n\n    // Observables\n\n    this.name = ko.observable(VerbEditorTabViewModel.tabName(data))\n\n    // Computeds\n\n    this.active = ko.computed(() => parentViewModel.activeTab() === this)\n    this.dirty = ko.computed(() => this.viewModel.dirty())\n  }\n\n  templateBinding () {\n    return { name: this.templateId, data: this.viewModel }\n  }\n\n  select () {\n    this.parentViewModel.activeTab(this)\n  }\n\n  close () {\n    if (this.viewModel.willClose()) {\n      this.parentViewModel.closeTab(this)\n    }\n  }\n\n  tabPaneClasses () {\n    return ['tab-pane-editor', 'tab-pane-verb-editor']\n  }\n\n  hideIfOnlyMe () {\n    return false\n  }\n\n  static tabName (data) {\n    return `${data.objectId}.${data.verb.name}`\n  }\n}\n","export default class FunctionEditorViewModel {\n  constructor ({ ko, CodeMirror, win }, parentViewModel, socket, { objectId, src, name }) {\n    // Properties\n\n    this.window = win\n    this.parentViewModel = parentViewModel\n    this.socket = socket\n    this.objectId = objectId\n    this.src = src\n    this.name = name\n    this.codemirrorOptions = {\n      lineNumbers: true,\n      theme: 'tomorrow-night-bright',\n      tabSize: 2,\n      indentWithTabs: false,\n      extraKeys: {\n        Tab: cm => {\n          if (cm.doc.somethingSelected()) {\n            return CodeMirror.Pass\n          }\n          return cm.execCommand('insertSoftTab')\n        }\n      }\n    }\n\n    // Observables\n\n    this.code = ko.observable(this.src)\n    this._code = ko.observable(this.src)\n\n    // Computeds\n\n    this.dirty = ko.computed(() => this.code() !== this._code())\n  }\n\n  save () {\n    const params = {\n      name: this.name,\n      src: this.code(),\n      objectId: this.objectId\n    }\n\n    if (!this.socket.connected) {\n      // eslint-disable-next-line no-alert\n      this.window.alert([\n        'The client tab that this editor was opened from has been',\n        'closed.  You must keep that open for saving to work.'\n      ].join(' '))\n      return\n    }\n\n    this.socket.emit('save-function', params, response => {\n      if (response === 'saved') {\n        this._code(this.code())\n      } else {\n        // eslint-disable-next-line no-alert\n        this.window.alert(response)\n      }\n    })\n  }\n\n  willClose () {\n    const msg = [\n      'Are you sure you want to close this tab?',\n      'You have unsaved changes that will be lost.'\n    ].join(' ')\n\n    return this.dirty()\n      // eslint-disable-next-line no-alert\n      ? this.window.confirm(msg)\n      : true\n  }\n\n  onKeyDown (_, event) {\n    const key = typeof event.which === 'undefined' ? event.keyCode : event.which\n    const meta = event.metaKey\n    const ctrl = event.ctrlKey\n    const sKey = key === 83\n    const wKey = key === 87\n\n    if ((ctrl && sKey) || (meta && sKey)) {\n      this.save()\n      return false\n    } else if ((ctrl && wKey) || (meta && wKey)) {\n      // this would be nice, but this is one shortcut you can't override...\n      this.parentViewModel.close()\n      return false\n    }\n    return true\n  }\n}\n","import FunctionEditorViewModel from './function-editor-view-model'\n\nexport default class FunctionEditorTabViewModel {\n  constructor (deps, parentViewModel, socket, data) {\n    const { ko } = deps\n\n    // Properties\n\n    this.parentViewModel = parentViewModel\n    this.templateId = 'function-editor'\n    this.viewModel = new FunctionEditorViewModel(deps, this, socket, data)\n\n    // Observables\n\n    this.name = ko.observable(FunctionEditorTabViewModel.tabName(data))\n\n    // Computeds\n\n    this.active = ko.computed(() => parentViewModel.activeTab() === this)\n    this.dirty = ko.computed(() => this.viewModel.dirty())\n  }\n\n  templateBinding () {\n    return { name: this.templateId, data: this.viewModel }\n  }\n\n  select () {\n    this.parentViewModel.activeTab(this)\n  }\n\n  close () {\n    if (this.viewModel.willClose()) {\n      this.parentViewModel.closeTab(this)\n    }\n  }\n\n  tabPaneClasses () {\n    return ['tab-pane-editor', 'tab-pane-function-editor']\n  }\n\n  hideIfOnlyMe () {\n    return false\n  }\n\n  static tabName (data) {\n    return `${data.objectId}.${data.name}`\n  }\n}\n","import ClientTabViewModel from './client-tab-view-model'\nimport VerbEditorTabViewModel from './verb-editor-tab-view-model'\nimport FunctionEditorTabViewModel from './function-editor-tab-view-model'\nimport SearchViewModel from './search-view-model'\n\nexport default class TabsViewModel {\n  constructor (deps) {\n    const { ko } = deps\n    this.deps = deps\n\n    // Observables\n\n    this.activeTab = ko.observable()\n    this.tabs = ko.observableArray([])\n    this.searchViewModel = ko.observable()\n\n    // Computeds\n\n    this.activeViewModel = ko.computed(this.computeActiveViewModel.bind(this))\n    this.hidden = ko.computed(this.computeHidden.bind(this))\n    this.visible = ko.computed(this.computeVisible.bind(this))\n    this.tabPaneClasses = ko.computed(this.computeTabPaneClasses.bind(this))\n    this.templateBinding = ko.computed(this.computeTemplateBinding.bind(this))\n    this.activeSocket = ko.computed(this.computeActiveSocket.bind(this))\n    this.anyTabLoggedIn = ko.computed(this.computedAnyTabLoggedIn.bind(this))\n\n    // Initialization\n\n    this.activeTab(this.tabs()[0])\n  }\n\n  computeActiveViewModel () {\n    const searchViewModel = this.searchViewModel()\n    if (searchViewModel) {\n      return searchViewModel\n    }\n    const activeTab = this.activeTab()\n    return activeTab ? activeTab.viewModel : this\n  }\n\n  computeHidden () {\n    const l = this.tabs().length\n    const t = this.tabs()[0]\n\n    return l === 0 || (l === 1 && t.hideIfOnlyMe())\n  }\n\n  computeVisible () {\n    return !this.hidden()\n  }\n\n  computeTabPaneClasses () {\n    const activeTab = this.activeTab()\n    let classes\n\n    if (activeTab) {\n      classes = activeTab.tabPaneClasses()\n    } else {\n      classes = []\n    }\n\n    if (this.visible()) {\n      classes.push('tabs-visible')\n    }\n\n    return classes.join(' ')\n  }\n\n  computeTemplateBinding () {\n    const activeTab = this.activeTab()\n    if (activeTab) {\n      return activeTab.templateBinding()\n    }\n    return { name: 'no-tabs', data: this }\n  }\n\n  computeActiveSocket () {\n    const activeViewModel = this.activeViewModel()\n    return activeViewModel.socket\n  }\n\n  computedAnyTabLoggedIn () {\n    return this.tabs().reduce((result, tab) =>\n      result || (tab.viewModel && tab.viewModel.loggedIn && tab.viewModel.loggedIn())\n    , false)\n  }\n\n  tabPaneClasses () {\n    return []\n  }\n\n  newClientTab () {\n    this.addAndSelectTab(new ClientTabViewModel(this.deps, this))\n  }\n\n  newEditVerbTab (...args) {\n    this.newEditTab(VerbEditorTabViewModel, ...args)\n  }\n\n  newEditFunctionTab (...args) {\n    this.newEditTab(FunctionEditorTabViewModel, ...args)\n  }\n\n  newEditTab (EditorTabViewModel, socket, data) {\n    const tabName = EditorTabViewModel.tabName(data)\n\n    if (this.selectExistingTab(tabName)) {\n      return\n    }\n\n    this.addAndSelectTab(new EditorTabViewModel(this.deps, this, socket, data))\n  }\n\n  addAndSelectTab (tab) {\n    this.tabs.push(tab)\n    tab.select()\n  }\n\n  selectExistingTab (name) {\n    let selected = false\n\n    this.tabs().forEach(tab => {\n      if (tab.name() === name) {\n        tab.select()\n        selected = true\n      }\n    })\n\n    return selected\n  }\n\n  closeTab (tab) {\n    const l = this.tabs().length - 1\n    let i = this.tabs.indexOf(tab)\n\n    if (i === l) { i -= 1 }\n    this.tabs.remove(tab)\n    if (l > 0) {\n      this.tabs()[i].select()\n    } else {\n      this.activeTab(null)\n    }\n  }\n\n  closeSameTabs (tab) {\n    // Close other tabs with same names, only if they are not edited\n    this.tabs().forEach(t => {\n      if (t.name() === tab.name() && !t.dirty()) {\n        this.closeTab(t)\n      }\n    })\n  }\n\n  onKeyDown (...args) {\n    const event = args[1]\n    const activeViewModel = this.activeViewModel()\n    const key = typeof event.which === 'undefined' ? event.keyCode : event.which\n    const meta = event.metaKey\n    const ctrl = event.ctrlKey\n    const pKey = key === 80\n\n    // open the search box on cmd+p (or ctrl+p) if it's not already open\n    if ((meta && pKey) || (ctrl && pKey)) {\n      if (!this.searchViewModel()) {\n        this.searchViewModel(new SearchViewModel(this.deps, this, this.activeSocket()))\n      }\n      return false\n    }\n\n    if (activeViewModel !== this && activeViewModel.onKeyDown) {\n      return activeViewModel.onKeyDown(...args)\n    }\n    return true\n  }\n\n  onKeyUp (...args) {\n    const activeViewModel = this.activeViewModel()\n\n    if (activeViewModel !== this && activeViewModel.onKeyUp) {\n      return activeViewModel.onKeyUp(...args)\n    }\n    return true\n  }\n}\n"],"names":["register","ko","CodeMirror","init","element","valueAccessor","allBindings","options","get","value","unwrap","editor","on","cm","getValue","update","observedValue","setValue","refresh","bindingHandlers","codemirror","classList","remove","uncloak","boldRed","str","boldGreen","gray","isElementVisibleIn","el","container","elRect","getBoundingClientRect","containerRect","top","left","bottom","right","addSaneOnUnloadHandler","win","promptBeforeLeaving","alreadPrompted","timeoutID","reset","onbeforeunload","setTimeout","NAVIGATE_AWAY_MESSAGE","onunload","factory","v","require","exports","rgx","tmplObj","subst","_i","arguments","length","wsrgx","txt2","raw","replace","RegExp","AnsiUp","VERSION","ansi_colors","rgb","class_name","htmlFormatter","fragment","instance","txt","text","_escape_for_html","old_escape_for_html","bright","fg","bg","styles","classes","_use_classes","push","join","class_string","style_string","segments","textFormatter","setup_256_palette","this","_buffer","defineProperty","prototype","arg","_this","palette_256","forEach","palette","rec","levels","r","g","b","col","grey_level","i","gry","old_linkify","detect_incomplete_ansi","test","detect_incomplete_link","found","prefix","substr","indexOf","ansi_to","formatter","pkt","raw_text_pkts","split","handle_incomplete_sequences","first_chunk","with_state","shift","blocks","Array","len","transform","process_ansi","unshift","compose","ansi_to_html","ansi_to_text","chunks","last_chunk","pop","slice","log","block","_sgr_regex","_a","matches","match","orig_txt","sgr_cmds","sgr_cmd_str","num","parseInt","isNaN","bidx","is_foreground","mode_cmd","palette_index","c","default","module","ClientViewModel","deps","parentViewModel","SERVER_URI","doc","io","linkifyHtml","observable","observableArray","computed","window","ansiUp","use_classes","$scrollingElement","scrollingElement","querySelector","socket","connect","history","inputCallback","lines","command","inputType","promptStr","rightPromptStr","inputHasFocus","loggedIn","playing","maxLines","readConfig","maxHistory","echo","space","promptFormatted","colorize","composedPrompt","rightPromptFormatted","subscribe","max","truncateLines","truncateHistory","writeConfig","onConnect","bind","onConnecting","onDisconnect","onConnectFailed","onError","onReconnectFailed","onReconnect","onReconnecting","onOutput","onSetPrompt","onSetRightPrompt","onRequestInput","onEditVerb","onEditFunction","onLogin","onLogout","onPlaying","onQuit","addLine","optionalStr","trim","type","echoCommand","addToHistory","handleClientCommand","connected","handleInputCallback","emit","currentHistory","reconnectSocket","disconnectSocket","newClientTab","close","callback","line","scrollToBottom","disconnect","scrollTop","scrollHeight","innerHeight","lengthDiff","_","event","key","which","keyCode","meta","metaKey","ctrl","ctrlKey","shiftKey","vKey","upKey","downKey","tabKey","onRecall","direction","target","hash","exec","decodeURIComponent","sendCommand","setPrompt","msg","toString","setRightPrompt","data","newEditVerbTab","newEditFunctionTab","inputs","fn","promptWas","getInputFromUser","formData","done","input","restInputs","label","name","userInput","localStorage","JSON","parse","getItem","setItem","stringify","pattern","capture","linkifyCommands","ClientTabViewModel","templateId","viewModel","dirty","active","computeActive","activeTab","willClose","closeTab","VerbEditorViewModel","verb","objectId","codemirrorOptions","somethingSelected","Pass","execCommand","dobjarg","preparg","iobjarg","code","_pattern","_dobjarg","_preparg","_iobjarg","_code","computeDirty","newVerb","params","response","alert","confirm","sKey","wKey","save","VerbEditorTabViewModel","tabName","FunctionEditorViewModel","src","_this2","FunctionEditorTabViewModel","SearchResult","computeName","Error","result","function","FunctionSearchResult","VerbSearchResult","tabsViewModel","SearchViewModel","document","search","results","selectedIndex","selectionDirection","onSearch","activeResult","computeActiveResult","hasResults","_this3","scrollActiveResultIntoView","scrollIntoView","searchViewModel","openEditor","map","newFromResult","_this4","openActiveResult","TabsViewModel","tabs","activeViewModel","computeActiveViewModel","hidden","computeHidden","visible","computeVisible","tabPaneClasses","computeTabPaneClasses","templateBinding","computeTemplateBinding","activeSocket","computeActiveSocket","anyTabLoggedIn","computedAnyTabLoggedIn","l","t","hideIfOnlyMe","reduce","tab","addAndSelectTab","args","newEditTab","EditorTabViewModel","selectExistingTab","select","selected","pKey","onKeyDown","onKeyUp"],"mappings":"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"}