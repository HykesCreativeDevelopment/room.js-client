!function(e){function t(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}var o=n(1),s=i(o),r=n(2),a=i(r),c=n(3),u=i(c),l=n(13),h=i(l),d=window,f=d.ko,p=d.CodeMirror,b=d.SERVER_URI;s.default.register(f,p),a.default.register(f);var v=document.createElement("script");v.src=b+'/socket.io/socket.io.js"><\/script>',v.addEventListener("load",function(){var e=window,t=e.alert,n=e.io,i=e.linkifyHtml;if(void 0===n)t("Unable to connect to "+b);else{var o={win:window,doc:document,ko:f,io:n,CodeMirror:p,linkifyHtml:i,SERVER_URI:b},s=new u.default(o);s.newClientTab(),f.applyBindings(s),(0,h.default)(window,function(){return s.anyTabLoggedIn()})}}),document.head.appendChild(v)},function(e,t,n){"use strict";function i(e,t){function n(n,i,o){var s=o.get("codemirrorOptions")||{};s.value=e.unwrap(i());var r=t(n,s);r.on("change",function(e){i()(e.getValue())}),n.editor=r}function i(t,n){var i=e.unwrap(n());if(t.editor){i!==t.editor.getValue()&&(t.editor.setValue(i),t.editor.refresh())}}e.bindingHandlers.codemirror={init:n,update:i}}Object.defineProperty(t,"__esModule",{value:!0}),t.default={register:i}},function(e,t,n){"use strict";function i(e){function t(e){e.classList.remove("cloak")}e.bindingHandlers.uncloak={init:t}}Object.defineProperty(t,"__esModule",{value:!0}),t.default={register:i}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(4),a=i(r),c=n(8),u=i(c),l=n(10),h=i(l),d=n(12),f=i(d),p=function(){function e(t){o(this,e);var n=t.ko;this.deps=t,this.activeTab=n.observable(),this.tabs=n.observableArray([]),this.searchViewModel=n.observable(),this.activeViewModel=n.computed(this.computeActiveViewModel.bind(this)),this.hidden=n.computed(this.computeHidden.bind(this)),this.visible=n.computed(this.computeVisible.bind(this)),this.tabPaneClasses=n.computed(this.computeTabPaneClasses.bind(this)),this.templateBinding=n.computed(this.computeTemplateBinding.bind(this)),this.activeSocket=n.computed(this.computeActiveSocket.bind(this)),this.anyTabLoggedIn=n.computed(this.computedAnyTabLoggedIn.bind(this)),this.activeTab(this.tabs()[0])}return s(e,[{key:"computeActiveViewModel",value:function(){var e=this.searchViewModel();if(e)return e;var t=this.activeTab();return t?t.viewModel:this}},{key:"computeHidden",value:function(){var e=this.tabs().length,t=this.tabs()[0];return 0===e||1===e&&t.hideIfOnlyMe()}},{key:"computeVisible",value:function(){return!this.hidden()}},{key:"computeTabPaneClasses",value:function(){var e=this.activeTab(),t=void 0;return t=e?e.tabPaneClasses():[],this.visible()&&t.push("tabs-visible"),t.join(" ")}},{key:"computeTemplateBinding",value:function(){var e=this.activeTab();return e?e.templateBinding():{name:"no-tabs",data:this}}},{key:"computeActiveSocket",value:function(){return this.activeViewModel().socket}},{key:"computedAnyTabLoggedIn",value:function(){return this.tabs().reduce(function(e,t){return e||t.viewModel&&t.viewModel.loggedIn&&t.viewModel.loggedIn()},!1)}},{key:"tabPaneClasses",value:function(){return[]}},{key:"newClientTab",value:function(){this.addAndSelectTab(new a.default(this.deps,this))}},{key:"newEditVerbTab",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];this.newEditTab.apply(this,[u.default].concat(t))}},{key:"newEditFunctionTab",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];this.newEditTab.apply(this,[h.default].concat(t))}},{key:"newEditTab",value:function(e,t,n){var i=e.tabName(n);this.selectExistingTab(i)||this.addAndSelectTab(new e(this.deps,this,t,n))}},{key:"addAndSelectTab",value:function(e){this.tabs.push(e),e.select()}},{key:"selectExistingTab",value:function(e){var t=!1;return this.tabs().forEach(function(n){n.name()===e&&(n.select(),t=!0)}),t}},{key:"closeTab",value:function(e){var t=this.tabs().length-1,n=this.tabs.indexOf(e);n===t&&(n-=1),this.tabs.remove(e),t>0?this.tabs()[n].select():this.activeTab(null)}},{key:"closeSameTabs",value:function(e){var t=this;this.tabs().forEach(function(n){n.name()!==e.name()||n.dirty()||t.closeTab(n)})}},{key:"onKeyDown",value:function(){var e=arguments.length<=1?void 0:arguments[1],t=this.activeViewModel(),n=void 0===e.which?e.keyCode:e.which,i=e.metaKey,o=e.ctrlKey,s=80===n;return i&&s||o&&s?(this.searchViewModel()||this.searchViewModel(new f.default(this.deps,this,this.activeSocket())),!1):t===this||!t.onKeyDown||t.onKeyDown.apply(t,arguments)}},{key:"onKeyUp",value:function(){var e=this.activeViewModel();return e===this||!e.onKeyUp||e.onKeyUp.apply(e,arguments)}}]),e}();t.default=p},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=n(5),r=function(e){return e&&e.__esModule?e:{default:e}}(s),a=function(){function e(t,n){i(this,e);var o=t.ko;this.parentViewModel=n,this.templateId="client",this.viewModel=new r.default(t,this),this.dirty=!1,this.name=o.observable("Room.js"),this.active=o.computed(this.computeActive.bind(this))}return o(e,[{key:"templateBinding",value:function(){return{name:this.templateId,data:this.viewModel}}},{key:"computeActive",value:function(){return this.parentViewModel.activeTab()===this}},{key:"select",value:function(){this.parentViewModel.activeTab(this),this.viewModel.scrollToBottom(),this.viewModel.inputHasFocus(!0)}},{key:"close",value:function(){this.viewModel.willClose()&&this.parentViewModel.closeTab(this)}},{key:"tabPaneClasses",value:function(){return["tab-pane-client"]}},{key:"hideIfOnlyMe",value:function(){return!0}}]),e}();t.default=a},function(e,t,n){"use strict";function i(e){return Array.isArray(e)?e:Array.from(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(6),a=function(e){return e&&e.__esModule?e:{default:e}}(r),c=n(7),u=function(){function e(t,n){var i=this;o(this,e);var s=t.SERVER_URI,r=t.doc,u=t.win,l=t.ko,h=t.io,d=t.linkifyHtml,f=l.observable,p=l.observableArray,b=l.computed;this.window=u,this.linkifyHtml=d,this.ansiUp=new a.default,this.ansiUp.use_classes=!0,this.$scrollingElement=r.scrollingElement,void 0===this.$scrollingElement&&(this.$scrollingElement=r.querySelector("html")),this.parentViewModel=n,this.socket=h.connect(s),this.history=[],this.inputCallback=null,this.lines=p([]),this.command=f(""),this.inputType=f("text"),this.promptStr=f(""),this.rightPromptStr=f(""),this.inputHasFocus=f(!0),this.loggedIn=f(!1),this.playing=f(!1),this.maxLines=f(this.readConfig("maxLines")||1e3),this.maxHistory=f(this.readConfig("maxHistory")||1e3),this.echo=f(this.readConfig("echo")||!1),this.space=f(this.readConfig("space")||!1),this.promptFormatted=b(function(){return i.colorize(i.composedPrompt())}),this.rightPromptFormatted=b(function(){return i.colorize(i.rightPromptStr())}),this.maxLines.subscribe(function(e){i.lines().length>e&&i.truncateLines()}),this.maxHistory.subscribe(function(e){i.history().length>e&&i.truncateHistory()}),this.echo.subscribe(function(e){i.writeConfig("echo",e)}),this.space.subscribe(function(e){i.writeConfig("space",e)}),this.socket.on("connect",this.onConnect.bind(this)),this.socket.on("connecting",this.onConnecting.bind(this)),this.socket.on("disconnect",this.onDisconnect.bind(this)),this.socket.on("connect_failed",this.onConnectFailed.bind(this)),this.socket.on("error",this.onError.bind(this)),this.socket.on("reconnect_failed",this.onReconnectFailed.bind(this)),this.socket.on("reconnect",this.onReconnect.bind(this)),this.socket.on("reconnecting",this.onReconnecting.bind(this)),this.socket.on("output",this.onOutput.bind(this)),this.socket.on("set-prompt",this.onSetPrompt.bind(this)),this.socket.on("set-right-prompt",this.onSetRightPrompt.bind(this)),this.socket.on("request-input",this.onRequestInput.bind(this)),this.socket.on("edit-verb",this.onEditVerb.bind(this)),this.socket.on("edit-function",this.onEditFunction.bind(this)),this.socket.on("login",this.onLogin.bind(this)),this.socket.on("logout",this.onLogout.bind(this)),this.socket.on("playing",this.onPlaying.bind(this)),this.socket.on("quit",this.onQuit.bind(this)),this.addLine((0,c.gray)("Connecting..."))}return s(e,[{key:"composedPrompt",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return(this.promptStr()+" > "+e).trim()}},{key:"setPrompt",value:function(e,t){this.promptStr(e),t&&this.inputType(t)}},{key:"setRightPrompt",value:function(e){this.rightPromptStr(e)}},{key:"sendCommand",value:function(){var e=this.command().trim();e&&(this.echoCommand(e),this.addToHistory(e),this.handleClientCommand(e)||(this.socket.connected?this.inputCallback?this.handleInputCallback(e):this.socket.emit("input",e):this.addLine((0,c.boldRed)("Not connected."))),this.command(""))}},{key:"echoCommand",value:function(e){this.echo()&&"password"!==this.inputType()&&(this.addLine(this.composedPrompt(e)),this.space()&&this.addLine(" "))}},{key:"addToHistory",value:function(e){"password"!==this.inputType()&&(this.history.unshift(e),this.history.length>this.maxHistory()&&this.truncateHistory(),this.currentHistory=-1)}},{key:"handleClientCommand",value:function(e){switch(e){case".clear":return this.lines([]),!0;case".connect":return this.reconnectSocket(),!0;case".disconnect":return this.disconnectSocket(),!0;case".echo on":return this.echo(!0),!0;case".echo off":return this.echo(!1),!0;case".space on":return this.space(!0),!0;case".space off":return this.space(!1),!0;case".new tab":return this.parentViewModel.parentViewModel.newClientTab(),!0;case".close tab":return this.parentViewModel.close(),!0;default:return!1}}},{key:"handleInputCallback",value:function(e){var t=this.inputCallback;this.inputCallback=null,t(e)}},{key:"addLine",value:function(e){this.lines.push(this.colorize(e)),this.scrollToBottom()}},{key:"disconnectSocket",value:function(){this.socket.connected?this.socket.disconnect():this.addLine((0,c.boldRed)("Not connected."))}},{key:"reconnectSocket",value:function(){this.socket.connected?this.addLine((0,c.boldRed)("Already connected.")):this.socket.connect()}},{key:"scrollToBottom",value:function(){this.$scrollingElement.scrollTop=this.$scrollingElement.scrollHeight-this.window.innerHeight}},{key:"truncateHistory",value:function(){this.history=this.history.slice(0,this.maxHistory())}},{key:"truncateLines",value:function(){var e=this.lines().length-this.maxLines();this.lines(this.lines.slice(e))}},{key:"willClose",value:function(){return this.socket.disconnect(),!0}},{key:"onKeyDown",value:function(e,t){var n=void 0===t.which?t.keyCode:t.which,i=t.metaKey,o=t.ctrlKey,s=t.shiftKey,r=86===n,a=38===n,c=40===n,u=9===n;if(i&&!r||o&&!r)return!0;if(!this.inputHasFocus()&&(this.inputHasFocus(!0),a||c))return this.onRecall(null,{which:n});if(u){var l=s?-1:1;return this.socket.emit("tab-key-press",{direction:l}),!1}return!0}},{key:"onClick",value:function(e,t){if(t.target&&t.target.hash){var n=/#cmd\[(.*?)]/g,i=n.exec(t.target.hash);if(!i)return!0;var o=decodeURIComponent(i[1]);return this.command(o),this.sendCommand(),!1}return!0}},{key:"onRecall",value:function(e,t){var n=void 0===t.which?t.keyCode:t.which;if(0===this.history.length)return!0;switch(n){case 38:return this.currentHistory<this.history.length-1&&(this.currentHistory+=1),this.command(this.history[this.currentHistory]),!1;case 40:this.currentHistory>-1&&(this.currentHistory-=1),this.currentHistory>=0?this.command(this.history[this.currentHistory]):this.command("")}return!0}},{key:"onConnect",value:function(){this.addLine((0,c.boldGreen)("Connected!"))}},{key:"onConnecting",value:function(){this.addLine((0,c.gray)("Connecting..."))}},{key:"onDisconnect",value:function(){this.addLine((0,c.boldRed)("Disconnected from server.")),this.setPrompt(""),this.inputCallback=null,this.loggedIn(!1),this.playing(!1)}},{key:"onConnectFailed",value:function(){this.addLine((0,c.boldRed)("Connection to server failed."))}},{key:"onError",value:function(){this.addLine((0,c.boldRed)("An unknown error occurred."))}},{key:"onReconnectFailed",value:function(){this.addLine((0,c.boldRed)("Unable to reconnect to server."))}},{key:"onReconnect",value:function(){}},{key:"onReconnecting",value:function(){}},{key:"onOutput",value:function(e){e&&e.toString&&(this.addLine(e.toString()),this.space()&&this.addLine(" "))}},{key:"onSetPrompt",value:function(e){this.setPrompt(e)}},{key:"onSetRightPrompt",value:function(e){this.setRightPrompt(e)}},{key:"onEditVerb",value:function(e){this.parentViewModel.parentViewModel.newEditVerbTab(this.socket,e)}},{key:"onEditFunction",value:function(e){this.parentViewModel.parentViewModel.newEditFunctionTab(this.socket,e)}},{key:"onLogin",value:function(){this.loggedIn(!0)}},{key:"onLogout",value:function(){this.loggedIn(!1)}},{key:"onPlaying",value:function(){this.playing(!0)}},{key:"onQuit",value:function(){this.playing(!1)}},{key:"onRequestInput",value:function(e,t){var n=this,i=this.promptStr();this.getInputFromUser({},e,function(e){n.setPrompt(i,"text"),t(e)})}},{key:"getInputFromUser",value:function(e,t,n){var o=this;if(0===t.length)return void n(e);var s=i(t),r=s[0],a=s.slice(1);this.setPrompt(r.label||"input",r.type||"text"),this.inputCallback=function(t){e[r.name||"input"]=t,o.getInputFromUser(e,a,n)}}},{key:"readConfig",value:function(e){return this.window.localStorage?JSON.parse(this.window.localStorage.getItem(e)):null}},{key:"writeConfig",value:function(e,t){this.window.localStorage&&this.window.localStorage.setItem(e,JSON.stringify(t))}},{key:"linkifyCommands",value:function(e){var t=/#cmd\[(.*?)]/g;return e.replace(t,function(e,t){return"<a href='"+e+"'>"+t+"</a>"})}},{key:"colorize",value:function(e){return this.linkifyCommands(this.linkifyHtml(this.ansiUp.ansi_to_html(e)))}}]),e}();t.default=u},function(e,t,n){var i,o,s;!function(n,r){o=[t],i=r,void 0!==(s="function"==typeof i?i.apply(t,o):i)&&(e.exports=s)}(0,function(e){"use strict";function t(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var i=e.raw[0],o=/^\s+|\s+\n|\s+#[\s\S]+?\n/gm,s=i.replace(o,"");return new RegExp(s,"m")}var n=function(){function e(){this.VERSION="2.0.1",this.ansi_colors=[[{rgb:[0,0,0],class_name:"ansi-black"},{rgb:[187,0,0],class_name:"ansi-red"},{rgb:[0,187,0],class_name:"ansi-green"},{rgb:[187,187,0],class_name:"ansi-yellow"},{rgb:[0,0,187],class_name:"ansi-blue"},{rgb:[187,0,187],class_name:"ansi-magenta"},{rgb:[0,187,187],class_name:"ansi-cyan"},{rgb:[255,255,255],class_name:"ansi-white"}],[{rgb:[85,85,85],class_name:"ansi-bright-black"},{rgb:[255,85,85],class_name:"ansi-bright-red"},{rgb:[0,255,0],class_name:"ansi-bright-green"},{rgb:[255,255,85],class_name:"ansi-bright-yellow"},{rgb:[85,85,255],class_name:"ansi-bright-blue"},{rgb:[255,85,255],class_name:"ansi-bright-magenta"},{rgb:[85,255,255],class_name:"ansi-bright-cyan"},{rgb:[255,255,255],class_name:"ansi-bright-white"}]],this.htmlFormatter={transform:function(e,t){var n=e.text;if(0===n.length)return n;if(t._escape_for_html&&(n=t.old_escape_for_html(n)),!e.bright&&null===e.fg&&null===e.bg)return n;var i=[],o=[],s=e.fg,r=e.bg;null===s&&e.bright&&(s=t.ansi_colors[1][7]),t._use_classes?(s&&("truecolor"!==s.class_name?o.push(s.class_name+"-fg"):i.push("color:rgb("+s.rgb.join(",")+")")),r&&("truecolor"!==r.class_name?o.push(r.class_name+"-bg"):i.push("background-color:rgb("+r.rgb.join(",")+")"))):(s&&i.push("color:rgb("+s.rgb.join(",")+")"),r&&i.push("background-color:rgb("+r.rgb+")"));var a="",c="";return o.length&&(a=' class="'+o.join(" ")+'"'),i.length&&(c=' style="'+i.join(";")+'"'),"<span"+a+c+">"+n+"</span>"},compose:function(e,t){return e.join("")}},this.textFormatter={transform:function(e,t){return e.text},compose:function(e,t){return e.join("")}},this.setup_256_palette(),this._use_classes=!1,this._escape_for_html=!0,this.bright=!1,this.fg=this.bg=null,this._buffer=""}return Object.defineProperty(e.prototype,"use_classes",{get:function(){return this._use_classes},set:function(e){this._use_classes=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"escape_for_html",{get:function(){return this._escape_for_html},set:function(e){this._escape_for_html=e},enumerable:!0,configurable:!0}),e.prototype.setup_256_palette=function(){var e=this;this.palette_256=[],this.ansi_colors.forEach(function(t){t.forEach(function(t){e.palette_256.push(t)})});for(var t=[0,95,135,175,215,255],n=0;n<6;++n)for(var i=0;i<6;++i)for(var o=0;o<6;++o){var s={rgb:[t[n],t[i],t[o]],class_name:"truecolor"};this.palette_256.push(s)}for(var r=8,a=0;a<24;++a,r+=10){var c={rgb:[r,r,r],class_name:"truecolor"};this.palette_256.push(c)}},e.prototype.old_escape_for_html=function(e){return e.replace(/[&<>]/gm,function(e){return"&"===e?"&amp;":"<"===e?"&lt;":">"===e?"&gt;":void 0})},e.prototype.old_linkify=function(e){return e.replace(/(https?:\/\/[^\s]+)/gm,function(e){return'<a href="'+e+'">'+e+"</a>"})},e.prototype.detect_incomplete_ansi=function(e){return!/.*?[\x40-\x7e]/.test(e)},e.prototype.detect_incomplete_link=function(e){for(var t=!1,n=e.length-1;n>0;n--)if(/\s|\x1B/.test(e[n])){t=!0;break}if(!t)return/(https?:\/\/[^\s]+)/.test(e)?0:-1;var i=e.substr(n+1,4);return 0===i.length?-1:0==="http".indexOf(i)?n+1:void 0},e.prototype.ansi_to=function(e,t){var n=this._buffer+e;this._buffer="";var i=n.split(/\x1B\[/);1===i.length&&i.push(""),this.handle_incomplete_sequences(i);for(var o=this.with_state(i.shift()),s=new Array(i.length),r=0,a=i.length;r<a;++r)s[r]=t.transform(this.process_ansi(i[r]),this);return o.text.length>0&&s.unshift(t.transform(o,this)),t.compose(s,this)},e.prototype.ansi_to_html=function(e){return this.ansi_to(e,this.htmlFormatter)},e.prototype.ansi_to_text=function(e){return this.ansi_to(e,this.textFormatter)},e.prototype.with_state=function(e){return{bright:this.bright,fg:this.fg,bg:this.bg,text:e}},e.prototype.handle_incomplete_sequences=function(e){var t=e[e.length-1];t.length>0&&this.detect_incomplete_ansi(t)?(this._buffer="["+t,e.pop(),e.push("")):(""===t.slice(-1)&&(this._buffer="",console.log("raw",e),e.pop(),e.push(t.substr(0,t.length-1)),console.log(e),console.log(t)),2===e.length&&""===e[1]&&""===e[0].slice(-1)&&(this._buffer="",t=e.shift(),e.unshift(t.substr(0,t.length-1))))},e.prototype.process_ansi=function(e){this._sgr_regex||(this._sgr_regex=(b=["\n            ^                           # beginning of line\n            ([!<-?]?)             # a private-mode char (!, <, =, >, ?)\n            ([d;]*)                    # any digits or semicolons\n            ([ -/]?               # an intermediate modifier\n            [@-~])                # the command\n            ([sS]*)                   # any text following this CSI sequence\n          "],b.raw=["\n            ^                           # beginning of line\n            ([!\\x3c-\\x3f]?)             # a private-mode char (!, <, =, >, ?)\n            ([\\d;]*)                    # any digits or semicolons\n            ([\\x20-\\x2f]?               # an intermediate modifier\n            [\\x40-\\x7e])                # the command\n            ([\\s\\S]*)                   # any text following this CSI sequence\n          "],t(b)));var n=e.match(this._sgr_regex);if(!n)return this.with_state(e);var i=n[4];if(""!==n[1]||"m"!==n[3])return this.with_state(i);for(var o=n[2].split(";");o.length>0;){var s=o.shift(),r=parseInt(s,10);if(isNaN(r)||0===r)this.fg=this.bg=null,this.bright=!1;else if(1===r)this.bright=!0;else if(22===r)this.bright=!1;else if(39===r)this.fg=null;else if(49===r)this.bg=null;else if(r>=30&&r<38){var a=this.bright?1:0;this.fg=this.ansi_colors[a][r-30]}else if(r>=90&&r<98)this.fg=this.ansi_colors[1][r-90];else if(r>=40&&r<48)this.bg=this.ansi_colors[0][r-40];else if(r>=100&&r<108)this.bg=this.ansi_colors[1][r-100];else if((38===r||48===r)&&o.length>0){var c=38===r,u=o.shift();if("5"===u&&o.length>0){var l=parseInt(o.shift(),10);l>=0&&l<=255&&(c?this.fg=this.palette_256[l]:this.bg=this.palette_256[l])}if("2"===u&&o.length>2){var h=parseInt(o.shift(),10),d=parseInt(o.shift(),10),f=parseInt(o.shift(),10);if(h>=0&&h<=255&&d>=0&&d<=255&&f>=0&&f<=255){var p={rgb:[h,d,f],class_name:"truecolor"};c?this.fg=p:this.bg=p}}}}return this.with_state(i);var b},e}();Object.defineProperty(e,"__esModule",{value:!0}),e.default=n})},function(e,t,n){"use strict";function i(e){return"[1m[31m"+e+"[39m[22m"}function o(e){return"[1m[32m"+e+"[39m[22m"}function s(e){return"[90m"+e+"[39m"}Object.defineProperty(t,"__esModule",{value:!0}),t.boldRed=i,t.boldGreen=o,t.gray=s},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=n(9),r=function(e){return e&&e.__esModule?e:{default:e}}(s),a=function(){function e(t,n,o,s){var a=this;i(this,e);var c=t.ko;this.parentViewModel=n,this.templateId="verb-editor",this.viewModel=new r.default(t,this,o,s),this.name=c.observable(e.tabName(s)),this.active=c.computed(function(){return n.activeTab()===a}),this.dirty=c.computed(function(){return a.viewModel.dirty()})}return o(e,[{key:"templateBinding",value:function(){return{name:this.templateId,data:this.viewModel}}},{key:"select",value:function(){this.parentViewModel.activeTab(this)}},{key:"close",value:function(){this.viewModel.willClose()&&this.parentViewModel.closeTab(this)}},{key:"tabPaneClasses",value:function(){return["tab-pane-editor","tab-pane-verb-editor"]}},{key:"hideIfOnlyMe",value:function(){return!1}}],[{key:"tabName",value:function(e){return e.objectId+"."+e.verb.name}}]),e}();t.default=a},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=function(){function e(t,n,o,s){var r=t.ko,a=t.CodeMirror,c=t.win,u=s.verb,l=s.objectId;i(this,e),this.window=c,this.parentViewModel=n,this.socket=o,this.objectId=l,this.name=u.name,this.codemirrorOptions={lineNumbers:!0,theme:"tomorrow-night-bright",tabSize:2,indentWithTabs:!1,extraKeys:{Tab:function(e){return e.doc.somethingSelected()?a.Pass:e.execCommand("insertSoftTab")}}},this.pattern=r.observable(u.pattern),this.dobjarg=r.observable(u.dobjarg),this.preparg=r.observable(u.preparg),this.iobjarg=r.observable(u.iobjarg),this.code=r.observable(u.code),this._pattern=r.observable(u.pattern),this._dobjarg=r.observable(u.dobjarg),this._preparg=r.observable(u.preparg),this._iobjarg=r.observable(u.iobjarg),this._code=r.observable(u.code),this.dirty=r.computed(this.computeDirty.bind(this))}return o(e,[{key:"computeDirty",value:function(){return this.pattern()!==this._pattern()||this.dobjarg()!==this._dobjarg()||this.preparg()!==this._preparg()||this.iobjarg()!==this._iobjarg()||this.code()!==this._code()}},{key:"save",value:function(){var e=this,t={name:this.name,pattern:this.pattern(),dobjarg:this.dobjarg(),preparg:this.preparg(),iobjarg:this.iobjarg(),code:this.code()},n={objectId:this.objectId,verb:t};if(!this.socket.connected)return void this.window.alert(["The client tab that this editor was opened from has been","closed.  You must keep that open for saving to work."].join(" "));this.socket.emit("save-verb",n,function(t){"saved"===t?(e._pattern(e.pattern()),e._dobjarg(e.dobjarg()),e._preparg(e.preparg()),e._iobjarg(e.iobjarg()),e._code(e.code())):e.window.alert(t)})}},{key:"willClose",value:function(){var e=["Are you sure you want to close this tab?","You have unsaved changes that will be lost."].join(" ");return!this.dirty()||this.window.confirm(e)}},{key:"onKeyDown",value:function(e,t){var n=void 0===t.which?t.keyCode:t.which,i=t.metaKey,o=t.ctrlKey,s=83===n,r=87===n;return o&&s||i&&s?(this.save(),!1):!(o&&r||i&&r)||(this.parentViewModel.close(),!1)}}]),e}();t.default=s},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=n(11),r=function(e){return e&&e.__esModule?e:{default:e}}(s),a=function(){function e(t,n,o,s){var a=this;i(this,e);var c=t.ko;this.parentViewModel=n,this.templateId="function-editor",this.viewModel=new r.default(t,this,o,s),this.name=c.observable(e.tabName(s)),this.active=c.computed(function(){return n.activeTab()===a}),this.dirty=c.computed(function(){return a.viewModel.dirty()})}return o(e,[{key:"templateBinding",value:function(){return{name:this.templateId,data:this.viewModel}}},{key:"select",value:function(){this.parentViewModel.activeTab(this)}},{key:"close",value:function(){this.viewModel.willClose()&&this.parentViewModel.closeTab(this)}},{key:"tabPaneClasses",value:function(){return["tab-pane-editor","tab-pane-function-editor"]}},{key:"hideIfOnlyMe",value:function(){return!1}}],[{key:"tabName",value:function(e){return e.objectId+"."+e.name}}]),e}();t.default=a},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=function(){function e(t,n,o,s){var r=t.ko,a=t.CodeMirror,c=t.win,u=this,l=s.objectId,h=s.src,d=s.name;i(this,e),this.window=c,this.parentViewModel=n,this.socket=o,this.objectId=l,this.src=h,this.name=d,this.codemirrorOptions={lineNumbers:!0,theme:"tomorrow-night-bright",tabSize:2,indentWithTabs:!1,extraKeys:{Tab:function(e){return e.doc.somethingSelected()?a.Pass:e.execCommand("insertSoftTab")}}},this.code=r.observable(this.src),this._code=r.observable(this.src),this.dirty=r.computed(function(){return u.code()!==u._code()})}return o(e,[{key:"save",value:function(){var e=this,t={name:this.name,src:this.code(),objectId:this.objectId};if(!this.socket.connected)return void this.window.alert(["The client tab that this editor was opened from has been","closed.  You must keep that open for saving to work."].join(" "));this.socket.emit("save-function",t,function(t){"saved"===t?e._code(e.code()):e.window.alert(t)})}},{key:"willClose",value:function(){var e=["Are you sure you want to close this tab?","You have unsaved changes that will be lost."].join(" ");return!this.dirty()||this.window.confirm(e)}},{key:"onKeyDown",value:function(e,t){var n=void 0===t.which?t.keyCode:t.which,i=t.metaKey,o=t.ctrlKey,s=83===n,r=87===n;return o&&s||i&&s?(this.save(),!1):!(o&&r||i&&r)||(this.parentViewModel.close(),!1)}}]),e}();t.default=s},function(e,t,n){"use strict";function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){var n=e.getBoundingClientRect(),i=t.getBoundingClientRect();return n.top>=i.top&&n.left>=i.left&&n.bottom<=i.bottom&&n.right<=i.right}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),c=function(){function e(t,n){s(this,e),this.data=n,this.objectId=n.objectId,this.active=t.observable(!1),this.name=t.computed(this.computeName.bind(this))}return a(e,[{key:"computeName",value:function(){throw new Error("Must be subclassed.")}},{key:"openEditor",value:function(){throw new Error("Must be subclassed.")}}],[{key:"newFromResult",value:function(e,t){if(t.function)return new u(e,t);if(t.verb)return new l(e,t);throw new Error("Invalid result type.")}}]),e}(),u=function(e){function t(){return s(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),a(t,[{key:"computeName",value:function(){return this.objectId+"."+this.data.function}},{key:"openEditor",value:function(e,t){var n={objectId:this.objectId,name:this.data.function};e.emit("get-function",n,function(n){t.newEditFunctionTab(e,n)})}}]),t}(c),l=function(e){function t(){return s(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),a(t,[{key:"computeName",value:function(){return this.objectId+"."+this.data.verb}},{key:"openEditor",value:function(e,t){var n={objectId:this.objectId,name:this.data.verb};e.emit("get-verb",n,function(n){t.newEditVerbTab(e,n)})}}]),t}(c),h=function(){function e(t,n,i){var o=t.doc,r=t.ko,a=this;s(this,e),this.document=o,this.ko=r,this.parentViewModel=n,this.socket=i,this.inputHasFocus=!0,this.search=r.observable(""),this.results=r.observableArray([]),this.selectedIndex=r.observable(0),this.selectionDirection=r.observable(0),this.search.subscribe(this.onSearch.bind(this)),this.activeResult=r.computed(this.computeActiveResult.bind(this)),this.hasResults=r.computed(function(){return a.results().length>0})}return a(e,[{key:"computeActiveResult",value:function(){var e=this.results(),t=this.selectedIndex();return e.length>0?(e.forEach(function(e){e.active(!1)}),e[t].active(!0),this.scrollActiveResultIntoView(),e[t]):null}},{key:"scrollActiveResultIntoView",value:function(){var e=this.document.querySelector(".search .results li.active"),t=this.document.querySelector(".search .results");e&&!r(e,t)&&e.scrollIntoView(-1===this.selectionDirection())}},{key:"close",value:function(){this.parentViewModel.searchViewModel(null)}},{key:"openActiveResult",value:function(){this.activeResult().openEditor(this.socket,this.parentViewModel)}},{key:"onSearch",value:function(e){var t=this;this.socket.emit("search",e,function(e){t.selectedIndex(0),t.results(e.map(function(e){return c.newFromResult(t.ko,e)}))})}},{key:"onKeyDown",value:function(e,t){var n=void 0===t.which?t.keyCode:t.which,i=this.selectedIndex();switch(n){case 13:return this.openActiveResult(),this.close(),!1;case 27:return this.close(),!1;case 38:return i>0?this.selectedIndex(i-1):this.selectedIndex(this.results().length-1),this.selectionDirection(-1),!1;case 40:return i<this.results().length-1?this.selectedIndex(i+1):this.selectedIndex(0),this.selectionDirection(1),!1;default:return!0}}}]),e}();t.default=h},function(e,t,n){"use strict";function i(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return!0},n=!1,i=0,s=function(){n=!1,i=0};e.onbeforeunload=function(){return t()&&!n?(n=!0,i=setTimeout(s,100),o):null},e.onunload=function(){clearTimeout(i)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=i;var o="This action will log you out of the game!"}]);