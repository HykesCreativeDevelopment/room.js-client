!function(t){"use strict";function e(t,e){function i(i,n,s){var o=s.get("codemirrorOptions")||{};o.value=t.unwrap(n());var r=e(i,o);r.on("change",function(t){n()(t.getValue())}),i.editor=r}function n(e,i){var n=t.unwrap(i());e.editor&&n!==e.editor.getValue()&&(e.editor.setValue(n),e.editor.refresh())}t.bindingHandlers.codemirror={init:i,update:n}}function i(t){function e(t){t.classList.remove("cloak")}t.bindingHandlers.uncloak={init:e}}function n(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")}function s(t){return"[1m[31m"+t+"[39m[22m"}function o(t){return"[1m[32m"+t+"[39m[22m"}function r(t){return"[90m"+t+"[39m"}function a(t,e){var i=t.getBoundingClientRect(),n=e.getBoundingClientRect();return i.top>=n.top&&i.left>=n.left&&i.bottom<=n.bottom&&i.right<=n.right}function c(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return!0},i=!1,n=0,s=function(){i=!1,n=0};t.onbeforeunload=function(){return e()&&!i?(i=!0,n=setTimeout(s,100),x):null},t.onunload=function(){clearTimeout(n)}}var h={register:e},u={register:i},l=function(t){return t&&t.__esModule?t.default:t}(function(t,e){return e={exports:{}},t(e,e.exports),e.exports}(function(t,e){!function(i){var s;void 0!==(s=function(t,e){function i(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var n=/^\s+|\s+\n|\s+#[\s\S]+?\n/gm,s=t.raw[0].replace(n,"");return new RegExp(s,"m")}var n=function(){function t(){this.VERSION="2.0.0",this.ansi_colors=[[{rgb:[0,0,0],class_name:"ansi-black"},{rgb:[187,0,0],class_name:"ansi-red"},{rgb:[0,187,0],class_name:"ansi-green"},{rgb:[187,187,0],class_name:"ansi-yellow"},{rgb:[0,0,187],class_name:"ansi-blue"},{rgb:[187,0,187],class_name:"ansi-magenta"},{rgb:[0,187,187],class_name:"ansi-cyan"},{rgb:[255,255,255],class_name:"ansi-white"}],[{rgb:[85,85,85],class_name:"ansi-bright-black"},{rgb:[255,85,85],class_name:"ansi-bright-red"},{rgb:[0,255,0],class_name:"ansi-bright-green"},{rgb:[255,255,85],class_name:"ansi-bright-yellow"},{rgb:[85,85,255],class_name:"ansi-bright-blue"},{rgb:[255,85,255],class_name:"ansi-bright-magenta"},{rgb:[85,255,255],class_name:"ansi-bright-cyan"},{rgb:[255,255,255],class_name:"ansi-bright-white"}]],this.htmlFormatter={transform:function(t,e){var i=t.text;if(0===i.length)return i;if(e._escape_for_html&&(i=e.old_escape_for_html(i)),!t.bright&&null===t.fg&&null===t.bg)return i;var n=[],s=[],o=t.fg,r=t.bg;null===o&&t.bright&&(o=e.ansi_colors[1][7]),e._use_classes?(o&&("truecolor"!==o.class_name?s.push(o.class_name+"-fg"):n.push("color:rgb("+o.rgb.join(",")+")")),r&&("truecolor"!==r.class_name?s.push(r.class_name+"-bg"):n.push("background-color:rgb("+r.rgb.join(",")+")"))):(o&&n.push("color:rgb("+o.rgb.join(",")+")"),r&&n.push("background-color:rgb("+r.rgb+")"));var a="",c="";return s.length&&(a=' class="'+s.join(" ")+'"'),n.length&&(c=' style="'+n.join(";")+'"'),"<span"+a+c+">"+i+"</span>"},compose:function(t,e){return t.join("")}},this.textFormatter={transform:function(t,e){return t.text},compose:function(t,e){return t.join("")}},this.setup_256_palette(),this._use_classes=!1,this._escape_for_html=!0,this.bright=!1,this.fg=this.bg=null,this._buffer=""}return Object.defineProperty(t.prototype,"use_classes",{get:function(){return this._use_classes},set:function(t){this._use_classes=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"escape_for_html",{get:function(){return this._escape_for_html},set:function(t){this._escape_for_html=t},enumerable:!0,configurable:!0}),t.prototype.setup_256_palette=function(){var t=this;this.palette_256=[],this.ansi_colors.forEach(function(e){e.forEach(function(e){t.palette_256.push(e)})});for(var e=[0,95,135,175,215,255],i=0;i<6;++i)for(var n=0;n<6;++n)for(var s=0;s<6;++s){var o={rgb:[e[i],e[n],e[s]],class_name:"truecolor"};this.palette_256.push(o)}for(var r=8,a=0;a<24;++a,r+=10){var c={rgb:[r,r,r],class_name:"truecolor"};this.palette_256.push(c)}},t.prototype.old_escape_for_html=function(t){return t.replace(/[&<>]/gm,function(t){return"&"===t?"&amp;":"<"===t?"&lt;":">"===t?"&gt;":void 0})},t.prototype.old_linkify=function(t){return t.replace(/(https?:\/\/[^\s]+)/gm,function(t){return'<a href="'+t+'">'+t+"</a>"})},t.prototype.detect_incomplete_ansi=function(t){return!/.*?[\x40-\x7e]/.test(t)},t.prototype.detect_incomplete_link=function(t){for(var e=!1,i=t.length-1;i>0;i--)if(/\s|\x1B/.test(t[i])){e=!0;break}if(!e)return/(https?:\/\/[^\s]+)/.test(t)?0:-1;var n=t.substr(i+1,4);return 0===n.length?-1:0==="http".indexOf(n)?i+1:void 0},t.prototype.ansi_to=function(t,e){var i=this._buffer+t;this._buffer="";var n=i.split(/\x1B\[/);1===n.length&&n.push(""),this.handle_incomplete_sequences(n);for(var s=this.with_state(n.shift()),o=new Array(n.length),r=0,a=n.length;r<a;++r)o[r]=e.transform(this.process_ansi(n[r]),this);return s.text.length>0&&o.unshift(e.transform(s,this)),e.compose(o,this)},t.prototype.ansi_to_html=function(t){return this.ansi_to(t,this.htmlFormatter)},t.prototype.ansi_to_text=function(t){return this.ansi_to(t,this.textFormatter)},t.prototype.with_state=function(t){return{bright:this.bright,fg:this.fg,bg:this.bg,text:t}},t.prototype.handle_incomplete_sequences=function(t){var e=t[t.length-1];e.length>0&&this.detect_incomplete_ansi(e)?(this._buffer="["+e,t.pop(),t.push("")):(""===e.slice(-1)&&(this._buffer="",console.log("raw",t),t.pop(),t.push(e.substr(0,e.length-1)),console.log(t),console.log(e)),2===t.length&&""===t[1]&&""===t[0].slice(-1)&&(this._buffer="",e=t.shift(),t.unshift(e.substr(0,e.length-1))))},t.prototype.process_ansi=function(t){this._sgr_regex||(this._sgr_regex=(b=["\n            ^                           # beginning of line\n            ([!<-?]?)             # a private-mode char (!, <, =, >, ?)\n            ([d;]*)                    # any digits or semicolons\n            ([ -/]?               # an intermediate modifier\n            [@-~])                # the command\n            ([sS]*)                   # any text following this CSI sequence\n          "],b.raw=["\n            ^                           # beginning of line\n            ([!\\x3c-\\x3f]?)             # a private-mode char (!, <, =, >, ?)\n            ([\\d;]*)                    # any digits or semicolons\n            ([\\x20-\\x2f]?               # an intermediate modifier\n            [\\x40-\\x7e])                # the command\n            ([\\s\\S]*)                   # any text following this CSI sequence\n          "],i(b)));var e=t.match(this._sgr_regex);if(!e)return this.with_state(t);var n=e[4];if(""!==e[1]||"m"!==e[3])return this.with_state(n);for(var s=e[2].split(";");s.length>0;){var o=s.shift(),r=parseInt(o,10);if(isNaN(r)||0===r)this.fg=this.bg=null,this.bright=!1;else if(1===r)this.bright=!0;else if(22===r)this.bright=!1;else if(39===r)this.fg=null;else if(49===r)this.bg=null;else if(r>=30&&r<38){var a=this.bright?1:0;this.fg=this.ansi_colors[a][r-30]}else if(r>=90&&r<98)this.fg=this.ansi_colors[1][r-90];else if(r>=40&&r<48)this.bg=this.ansi_colors[0][r-40];else if(r>=100&&r<108)this.bg=this.ansi_colors[1][r-100];else if((38===r||48===r)&&s.length>0){var c=38===r,h=s.shift();if("5"===h&&s.length>0){var u=parseInt(s.shift(),10);u>=0&&u<=255&&(c?this.fg=this.palette_256[u]:this.bg=this.palette_256[u])}if("2"===h&&s.length>2){var l=parseInt(s.shift(),10),d=parseInt(s.shift(),10),f=parseInt(s.shift(),10);if(l>=0&&l<=255&&d>=0&&d<=255&&f>=0&&f<=255){var p={rgb:[l,d,f],class_name:"truecolor"};c?this.fg=p:this.bg=p}}}}return this.with_state(n);var b},t}();Object.defineProperty(e,"__esModule",{value:!0}),e.default=n}(n,e))&&(t.exports=s)}()})),d=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},f=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),p=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},b=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},m=function(t){return Array.isArray(t)?t:Array.from(t)},v=function(){function t(e,i){var n=this;d(this,t);var s=e.SERVER_URI,o=e.doc,a=e.win,c=e.ko,h=e.io,u=e.linkifyHtml,f=c.observable,p=c.observableArray,b=c.computed;this.window=a,this.linkifyHtml=u,this.ansiUp=new l,this.ansiUp.use_classes=!0,this.$scrollingElement=o.scrollingElement,void 0===this.$scrollingElement&&(this.$scrollingElement=o.querySelector("html")),this.parentViewModel=i,this.socket=h.connect(s),this.history=[],this.inputCallback=null,this.lines=p([]),this.command=f(""),this.inputType=f("text"),this.promptStr=f(""),this.rightPromptStr=f(""),this.inputHasFocus=f(!0),this.loggedIn=f(!1),this.playing=f(!1),this.maxLines=f(this.readConfig("maxLines")||1e3),this.maxHistory=f(this.readConfig("maxHistory")||1e3),this.echo=f(this.readConfig("echo")||!1),this.space=f(this.readConfig("space")||!1),this.promptFormatted=b(function(){return n.colorize(n.composedPrompt())}),this.rightPromptFormatted=b(function(){return n.colorize(n.rightPromptStr())}),this.maxLines.subscribe(function(t){n.lines().length>t&&n.truncateLines()}),this.maxHistory.subscribe(function(t){n.history().length>t&&n.truncateHistory()}),this.echo.subscribe(function(t){n.writeConfig("echo",t)}),this.space.subscribe(function(t){n.writeConfig("space",t)}),this.socket.on("connect",this.onConnect.bind(this)),this.socket.on("connecting",this.onConnecting.bind(this)),this.socket.on("disconnect",this.onDisconnect.bind(this)),this.socket.on("connect_failed",this.onConnectFailed.bind(this)),this.socket.on("error",this.onError.bind(this)),this.socket.on("reconnect_failed",this.onReconnectFailed.bind(this)),this.socket.on("reconnect",this.onReconnect.bind(this)),this.socket.on("reconnecting",this.onReconnecting.bind(this)),this.socket.on("output",this.onOutput.bind(this)),this.socket.on("set-prompt",this.onSetPrompt.bind(this)),this.socket.on("set-right-prompt",this.onSetRightPrompt.bind(this)),this.socket.on("request-input",this.onRequestInput.bind(this)),this.socket.on("edit-verb",this.onEditVerb.bind(this)),this.socket.on("edit-function",this.onEditFunction.bind(this)),this.socket.on("login",this.onLogin.bind(this)),this.socket.on("logout",this.onLogout.bind(this)),this.socket.on("playing",this.onPlaying.bind(this)),this.socket.on("quit",this.onQuit.bind(this)),this.addLine(r("Connecting..."))}return f(t,[{key:"composedPrompt",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return(this.promptStr()+" > "+t).trim()}},{key:"setPrompt",value:function(t,e){this.promptStr(t),e&&this.inputType(e)}},{key:"setRightPrompt",value:function(t){this.rightPromptStr(t)}},{key:"sendCommand",value:function(){var t=this.command().trim();t&&(this.echoCommand(t),this.addToHistory(t),this.handleClientCommand(t)||(this.socket.connected?this.inputCallback?this.handleInputCallback(t):this.socket.emit("input",t):this.addLine(s("Not connected."))),this.command(""))}},{key:"echoCommand",value:function(t){this.echo()&&"password"!==this.inputType()&&(this.addLine(this.composedPrompt(t)),this.space()&&this.addLine(" "))}},{key:"addToHistory",value:function(t){"password"!==this.inputType()&&(this.history.unshift(t),this.history.length>this.maxHistory()&&this.truncateHistory(),this.currentHistory=-1)}},{key:"handleClientCommand",value:function(t){switch(t){case".clear":return this.lines([]),!0;case".connect":return this.reconnectSocket(),!0;case".disconnect":return this.disconnectSocket(),!0;case".echo on":return this.echo(!0),!0;case".echo off":return this.echo(!1),!0;case".space on":return this.space(!0),!0;case".space off":return this.space(!1),!0;case".new tab":return this.parentViewModel.parentViewModel.newClientTab(),!0;case".close tab":return this.parentViewModel.close(),!0;default:return!1}}},{key:"handleInputCallback",value:function(t){var e=this.inputCallback;this.inputCallback=null,e(t)}},{key:"addLine",value:function(t){this.lines.push(this.colorize(t)),this.scrollToBottom()}},{key:"disconnectSocket",value:function(){this.socket.connected?this.socket.disconnect():this.addLine(s("Not connected."))}},{key:"reconnectSocket",value:function(){this.socket.connected?this.addLine(s("Already connected.")):this.socket.connect()}},{key:"scrollToBottom",value:function(){this.$scrollingElement.scrollTop=this.$scrollingElement.scrollHeight-this.window.innerHeight}},{key:"truncateHistory",value:function(){this.history=this.history.slice(0,this.maxHistory())}},{key:"truncateLines",value:function(){var t=this.lines().length-this.maxLines();this.lines(this.lines.slice(t))}},{key:"willClose",value:function(){return this.socket.disconnect(),!0}},{key:"onKeyDown",value:function(t,e){var i=void 0===e.which?e.keyCode:e.which,n=e.metaKey,s=e.ctrlKey,o=e.shiftKey,r=86===i,a=38===i,c=40===i,h=9===i;if(n&&!r||s&&!r)return!0;if(!this.inputHasFocus()&&(this.inputHasFocus(!0),a||c))return this.onRecall(null,{which:i});if(h){var u=o?-1:1;return this.socket.emit("tab-key-press",{direction:u}),!1}return!0}},{key:"onClick",value:function(t,e){if(e.target&&e.target.hash){var i=/#cmd\[(.*?)]/g.exec(e.target.hash);if(!i)return!0;var n=decodeURIComponent(i[1]);return this.command(n),this.sendCommand(),!1}return!0}},{key:"onRecall",value:function(t,e){var i=void 0===e.which?e.keyCode:e.which;if(0===this.history.length)return!0;switch(i){case 38:return this.currentHistory<this.history.length-1&&(this.currentHistory+=1),this.command(this.history[this.currentHistory]),!1;case 40:this.currentHistory>-1&&(this.currentHistory-=1),this.currentHistory>=0?this.command(this.history[this.currentHistory]):this.command("")}return!0}},{key:"onConnect",value:function(){this.addLine(o("Connected!"))}},{key:"onConnecting",value:function(){this.addLine(r("Connecting..."))}},{key:"onDisconnect",value:function(){this.addLine(s("Disconnected from server.")),this.setPrompt(""),this.inputCallback=null,this.loggedIn(!1),this.playing(!1)}},{key:"onConnectFailed",value:function(){this.addLine(s("Connection to server failed."))}},{key:"onError",value:function(){this.addLine(s("An unknown error occurred."))}},{key:"onReconnectFailed",value:function(){this.addLine(s("Unable to reconnect to server."))}},{key:"onReconnect",value:function(){}},{key:"onReconnecting",value:function(){}},{key:"onOutput",value:function(t){t&&t.toString&&(this.addLine(t.toString()),this.space()&&this.addLine(" "))}},{key:"onSetPrompt",value:function(t){this.setPrompt(t)}},{key:"onSetRightPrompt",value:function(t){this.setRightPrompt(t)}},{key:"onEditVerb",value:function(t){this.parentViewModel.parentViewModel.newEditVerbTab(this.socket,t)}},{key:"onEditFunction",value:function(t){this.parentViewModel.parentViewModel.newEditFunctionTab(this.socket,t)}},{key:"onLogin",value:function(){this.loggedIn(!0)}},{key:"onLogout",value:function(){this.loggedIn(!1)}},{key:"onPlaying",value:function(){this.playing(!0)}},{key:"onQuit",value:function(){this.playing(!1)}},{key:"onRequestInput",value:function(t,e){var i=this,n=this.promptStr();this.getInputFromUser({},t,function(t){i.setPrompt(n,"text"),e(t)})}},{key:"getInputFromUser",value:function(t,e,i){var n=this;if(0!==e.length){var s=m(e),o=s[0],r=s.slice(1);this.setPrompt(o.label||"input",o.type||"text"),this.inputCallback=function(e){t[o.name||"input"]=e,n.getInputFromUser(t,r,i)}}else i(t)}},{key:"readConfig",value:function(t){return this.window.localStorage?JSON.parse(this.window.localStorage.getItem(t)):null}},{key:"writeConfig",value:function(t,e){this.window.localStorage&&this.window.localStorage.setItem(t,JSON.stringify(e))}},{key:"linkifyCommands",value:function(t){var e=/#cmd\[(.*?)]/g;return t.replace(e,function(t,e){return"<a href='"+t+"'>"+e+"</a>"})}},{key:"colorize",value:function(t){return this.linkifyCommands(this.linkifyHtml(this.ansiUp.ansi_to_html(t)))}}]),t}(),g=function(){function t(e,i){d(this,t);var n=e.ko;this.parentViewModel=i,this.templateId="client",this.viewModel=new v(e,this),this.dirty=!1,this.name=n.observable("Room.js"),this.active=n.computed(this.computeActive.bind(this))}return f(t,[{key:"templateBinding",value:function(){return{name:this.templateId,data:this.viewModel}}},{key:"computeActive",value:function(){return this.parentViewModel.activeTab()===this}},{key:"select",value:function(){this.parentViewModel.activeTab(this),this.viewModel.scrollToBottom(),this.viewModel.inputHasFocus(!0)}},{key:"close",value:function(){this.viewModel.willClose()&&this.parentViewModel.closeTab(this)}},{key:"tabPaneClasses",value:function(){return["tab-pane-client"]}},{key:"hideIfOnlyMe",value:function(){return!0}}]),t}(),y=function(){function t(e,i,n,s){var o=e.ko,r=e.CodeMirror,a=e.win,c=s.verb,h=s.objectId;d(this,t),this.window=a,this.parentViewModel=i,this.socket=n,this.objectId=h,this.name=c.name,this.codemirrorOptions={lineNumbers:!0,theme:"tomorrow-night-bright",tabSize:2,indentWithTabs:!1,extraKeys:{Tab:function(t){return t.doc.somethingSelected()?r.Pass:t.execCommand("insertSoftTab")}}},this.pattern=o.observable(c.pattern),this.dobjarg=o.observable(c.dobjarg),this.preparg=o.observable(c.preparg),this.iobjarg=o.observable(c.iobjarg),this.code=o.observable(c.code),this._pattern=o.observable(c.pattern),this._dobjarg=o.observable(c.dobjarg),this._preparg=o.observable(c.preparg),this._iobjarg=o.observable(c.iobjarg),this._code=o.observable(c.code),this.dirty=o.computed(this.computeDirty.bind(this))}return f(t,[{key:"computeDirty",value:function(){return this.pattern()!==this._pattern()||this.dobjarg()!==this._dobjarg()||this.preparg()!==this._preparg()||this.iobjarg()!==this._iobjarg()||this.code()!==this._code()}},{key:"save",value:function(){var t=this,e={name:this.name,pattern:this.pattern(),dobjarg:this.dobjarg(),preparg:this.preparg(),iobjarg:this.iobjarg(),code:this.code()},i={objectId:this.objectId,verb:e};this.socket.connected?this.socket.emit("save-verb",i,function(e){"saved"===e?(t._pattern(t.pattern()),t._dobjarg(t.dobjarg()),t._preparg(t.preparg()),t._iobjarg(t.iobjarg()),t._code(t.code())):t.window.alert(e)}):this.window.alert(["The client tab that this editor was opened from has been","closed.  You must keep that open for saving to work."].join(" "))}},{key:"willClose",value:function(){var t=["Are you sure you want to close this tab?","You have unsaved changes that will be lost."].join(" ");return!this.dirty()||this.window.confirm(t)}},{key:"onKeyDown",value:function(t,e){var i=void 0===e.which?e.keyCode:e.which,n=e.metaKey,s=e.ctrlKey,o=83===i,r=87===i;return s&&o||n&&o?(this.save(),!1):!(s&&r||n&&r)||(this.parentViewModel.close(),!1)}}]),t}(),k=function(){function t(e,i,n,s){var o=this;d(this,t);var r=e.ko;this.parentViewModel=i,this.templateId="verb-editor",this.viewModel=new y(e,this,n,s),this.name=r.observable(t.tabName(s)),this.active=r.computed(function(){return i.activeTab()===o}),this.dirty=r.computed(function(){return o.viewModel.dirty()})}return f(t,[{key:"templateBinding",value:function(){return{name:this.templateId,data:this.viewModel}}},{key:"select",value:function(){this.parentViewModel.activeTab(this)}},{key:"close",value:function(){this.viewModel.willClose()&&this.parentViewModel.closeTab(this)}},{key:"tabPaneClasses",value:function(){return["tab-pane-editor","tab-pane-verb-editor"]}},{key:"hideIfOnlyMe",value:function(){return!1}}],[{key:"tabName",value:function(t){return t.objectId+"."+t.verb.name}}]),t}(),w=function(){function t(e,i,n,s){var o=e.ko,r=e.CodeMirror,a=e.win,c=this,h=s.objectId,u=s.src,l=s.name;d(this,t),this.window=a,this.parentViewModel=i,this.socket=n,this.objectId=h,this.src=u,this.name=l,this.codemirrorOptions={lineNumbers:!0,theme:"tomorrow-night-bright",tabSize:2,indentWithTabs:!1,extraKeys:{Tab:function(t){return t.doc.somethingSelected()?r.Pass:t.execCommand("insertSoftTab")}}},this.code=o.observable(this.src),this._code=o.observable(this.src),this.dirty=o.computed(function(){return c.code()!==c._code()})}return f(t,[{key:"save",value:function(){var t=this,e={name:this.name,src:this.code(),objectId:this.objectId};this.socket.connected?this.socket.emit("save-function",e,function(e){"saved"===e?t._code(t.code()):t.window.alert(e)}):this.window.alert(["The client tab that this editor was opened from has been","closed.  You must keep that open for saving to work."].join(" "))}},{key:"willClose",value:function(){var t=["Are you sure you want to close this tab?","You have unsaved changes that will be lost."].join(" ");return!this.dirty()||this.window.confirm(t)}},{key:"onKeyDown",value:function(t,e){var i=void 0===e.which?e.keyCode:e.which,n=e.metaKey,s=e.ctrlKey,o=83===i,r=87===i;return s&&o||n&&o?(this.save(),!1):!(s&&r||n&&r)||(this.parentViewModel.close(),!1)}}]),t}(),_=function(){function t(e,i,n,s){var o=this;d(this,t);var r=e.ko;this.parentViewModel=i,this.templateId="function-editor",this.viewModel=new w(e,this,n,s),this.name=r.observable(t.tabName(s)),this.active=r.computed(function(){return i.activeTab()===o}),this.dirty=r.computed(function(){return o.viewModel.dirty()})}return f(t,[{key:"templateBinding",value:function(){return{name:this.templateId,data:this.viewModel}}},{key:"select",value:function(){this.parentViewModel.activeTab(this)}},{key:"close",value:function(){this.viewModel.willClose()&&this.parentViewModel.closeTab(this)}},{key:"tabPaneClasses",value:function(){return["tab-pane-editor","tab-pane-function-editor"]}},{key:"hideIfOnlyMe",value:function(){return!1}}],[{key:"tabName",value:function(t){return t.objectId+"."+t.name}}]),t}(),C=function(){function t(e,i){d(this,t),this.data=i,this.objectId=i.objectId,this.active=e.observable(!1),this.name=e.computed(this.computeName.bind(this))}return f(t,[{key:"computeName",value:function(){throw new Error("Must be subclassed.")}},{key:"openEditor",value:function(){throw new Error("Must be subclassed.")}}],[{key:"newFromResult",value:function(t,e){if(e.function)return new I(t,e);if(e.verb)return new T(t,e);throw new Error("Invalid result type.")}}]),t}(),I=function(t){function e(){return d(this,e),b(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return p(e,t),f(e,[{key:"computeName",value:function(){return this.objectId+"."+this.data.function}},{key:"openEditor",value:function(t,e){var i={objectId:this.objectId,name:this.data.function};t.emit("get-function",i,function(i){e.newEditFunctionTab(t,i)})}}]),e}(C),T=function(t){function e(){return d(this,e),b(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return p(e,t),f(e,[{key:"computeName",value:function(){return this.objectId+"."+this.data.verb}},{key:"openEditor",value:function(t,e){var i={objectId:this.objectId,name:this.data.verb};t.emit("get-verb",i,function(i){e.newEditVerbTab(t,i)})}}]),e}(C),M=function(){function t(e,i,n){var s=e.doc,o=e.ko,r=this;d(this,t),this.document=s,this.ko=o,this.parentViewModel=i,this.socket=n,this.inputHasFocus=!0,this.search=o.observable(""),this.results=o.observableArray([]),this.selectedIndex=o.observable(0),this.selectionDirection=o.observable(0),this.search.subscribe(this.onSearch.bind(this)),this.activeResult=o.computed(this.computeActiveResult.bind(this)),this.hasResults=o.computed(function(){return r.results().length>0})}return f(t,[{key:"computeActiveResult",value:function(){var t=this.results(),e=this.selectedIndex();return t.length>0?(t.forEach(function(t){t.active(!1)}),t[e].active(!0),this.scrollActiveResultIntoView(),t[e]):null}},{key:"scrollActiveResultIntoView",value:function(){var t=this.document.querySelector(".search .results li.active"),e=this.document.querySelector(".search .results");t&&!a(t,e)&&t.scrollIntoView(-1===this.selectionDirection())}},{key:"close",value:function(){this.parentViewModel.searchViewModel(null)}},{key:"openActiveResult",value:function(){this.activeResult().openEditor(this.socket,this.parentViewModel)}},{key:"onSearch",value:function(t){var e=this;this.socket.emit("search",t,function(t){e.selectedIndex(0),e.results(t.map(function(t){return C.newFromResult(e.ko,t)}))})}},{key:"onKeyDown",value:function(t,e){var i=void 0===e.which?e.keyCode:e.which,n=this.selectedIndex();switch(i){case 13:return this.openActiveResult(),this.close(),!1;case 27:return this.close(),!1;case 38:return n>0?this.selectedIndex(n-1):this.selectedIndex(this.results().length-1),this.selectionDirection(-1),!1;case 40:return n<this.results().length-1?this.selectedIndex(n+1):this.selectedIndex(0),this.selectionDirection(1),!1;default:return!0}}}]),t}(),j=function(){function t(e){d(this,t);var i=e.ko;this.deps=e,this.activeTab=i.observable(),this.tabs=i.observableArray([]),this.searchViewModel=i.observable(),this.activeViewModel=i.computed(this.computeActiveViewModel.bind(this)),this.hidden=i.computed(this.computeHidden.bind(this)),this.visible=i.computed(this.computeVisible.bind(this)),this.tabPaneClasses=i.computed(this.computeTabPaneClasses.bind(this)),this.templateBinding=i.computed(this.computeTemplateBinding.bind(this)),this.activeSocket=i.computed(this.computeActiveSocket.bind(this)),this.anyTabLoggedIn=i.computed(this.computedAnyTabLoggedIn.bind(this)),this.activeTab(this.tabs()[0])}return f(t,[{key:"computeActiveViewModel",value:function(){var t=this.searchViewModel();if(t)return t;var e=this.activeTab();return e?e.viewModel:this}},{key:"computeHidden",value:function(){var t=this.tabs().length,e=this.tabs()[0];return 0===t||1===t&&e.hideIfOnlyMe()}},{key:"computeVisible",value:function(){return!this.hidden()}},{key:"computeTabPaneClasses",value:function(){var t=this.activeTab(),e=void 0;return e=t?t.tabPaneClasses():[],this.visible()&&e.push("tabs-visible"),e.join(" ")}},{key:"computeTemplateBinding",value:function(){var t=this.activeTab();return t?t.templateBinding():{name:"no-tabs",data:this}}},{key:"computeActiveSocket",value:function(){return this.activeViewModel().socket}},{key:"computedAnyTabLoggedIn",value:function(){return this.tabs().reduce(function(t,e){return t||e.viewModel&&e.viewModel.loggedIn&&e.viewModel.loggedIn()},!1)}},{key:"tabPaneClasses",value:function(){return[]}},{key:"newClientTab",value:function(){this.addAndSelectTab(new g(this.deps,this))}},{key:"newEditVerbTab",value:function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];this.newEditTab.apply(this,[k].concat(e))}},{key:"newEditFunctionTab",value:function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];this.newEditTab.apply(this,[_].concat(e))}},{key:"newEditTab",value:function(t,e,i){var n=t.tabName(i);this.selectExistingTab(n)||this.addAndSelectTab(new t(this.deps,this,e,i))}},{key:"addAndSelectTab",value:function(t){this.tabs.push(t),t.select()}},{key:"selectExistingTab",value:function(t){var e=!1;return this.tabs().forEach(function(i){i.name()===t&&(i.select(),e=!0)}),e}},{key:"closeTab",value:function(t){var e=this.tabs().length-1,i=this.tabs.indexOf(t);i===e&&(i-=1),this.tabs.remove(t),e>0?this.tabs()[i].select():this.activeTab(null)}},{key:"closeSameTabs",value:function(t){var e=this;this.tabs().forEach(function(i){i.name()!==t.name()||i.dirty()||e.closeTab(i)})}},{key:"onKeyDown",value:function(){var t=arguments.length<=1?void 0:arguments[1],e=this.activeViewModel(),i=void 0===t.which?t.keyCode:t.which,n=t.metaKey,s=t.ctrlKey,o=80===i;return n&&o||s&&o?(this.searchViewModel()||this.searchViewModel(new M(this.deps,this,this.activeSocket())),!1):e===this||!e.onKeyDown||e.onKeyDown.apply(e,arguments)}},{key:"onKeyUp",value:function(){var t=this.activeViewModel();return t===this||!t.onKeyUp||t.onKeyUp.apply(t,arguments)}}]),t}(),x="This action will log you out of the game!";t.codemirrorBinding=h,t.uncloackBinding=u,t.TabsViewModel=j,t.addSaneOnUnloadHandler=c}(this.bundle=this.bundle||{});
//# sourceMappingURL=bundle.js.map
